namespace = bp_tax_evasion_outcome

#_A lot_ of this was cribbed from Vanilla Murder Schemes
scripted_effect tax_evasion_outcome_roll_setup_effect = {
	#Discovery Roll setup
	save_scope_value_as = {
		name = discovery_chance
		value = {
			value = 100
			subtract = scope:scheme.scheme_secrecy
		}
	}
}
scripted_effect tax_evasion_scheme_outcome_roll_effect = {
	#SUCCESS ROLL
	random = {
		chance = scope:scheme.scheme_success_chance
		custom_tooltip = murder_successful_roll_tt
		save_scope_value_as = {
			name = scheme_successful
			value = yes
		}
	}
	### End Success roll
	#DISCOVERY ROLL
	custom_description_no_bullet = { text = in_addition_effect_tooltip }
	random = {
		chance = scope:discovery_chance
		custom_tooltip = scheme_remain_secret_roll_tt
		save_scope_value_as = { name = scheme_discovered value = yes }
		if = {
			limit = { exists = scope:target.host }
			scope:target.host = { save_scope_as = tax_evasion_exposer }
		}
		else = { scope:target = { save_scope_as = tax_evasion_exposer } }
	}
	### End Discovery roll

	hidden_effect = {
		#FIRE CORRECT ON ACTIONS
		if = {
			limit = { exists = scope:scheme_successful }
			trigger_event = {
				on_action = murder_save_roll
				days = 3
			}
		}
		else = {
			trigger_event = {
				on_action = murder_failed
				days = 3
			}
		}
	}
}

#Determine Success or Failure
bp_tax_evasion_outcome.0001 = {
	immediate = { tax_evasion_outcome_roll_setup_effect = yes }
	
	option = {
		bp_tax_evasion_outcome.0001.a
		tax_evasion_scheme_outcome_roll_effect = yes
	}
	
	
	
}