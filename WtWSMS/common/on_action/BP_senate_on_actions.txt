# Called every Jan 1st
# Root does not exist
yearly_global_pulse = {
	on_actions = {
		delay = { days = { 3 28 } }
		senatorial_election_west
		senatorial_election_east
	}
}

senatorial_election_east = {
	effect = {
		#Yearly Senate Election Fires
		senate_election_effect = {
			REGION = east
			LOCATION = constantinople
			BARONY = b_constantinople
		}
	}
}

senatorial_election_west = {
	effect = {
		#Yearly Senate Election Fires
		senate_election_effect = {
			REGION = west
			LOCATION = rome
			BARONY = b_roma
		}
	}
}

# character just about to die in root scope
# if a killer is known, it's set as scope:killer
#Triggered by code
on_death = {
	on_actions = {
		snap_election
	}
}

#Consul died early, call a snap election
snap_election = {
	effect = {
		if = {
			limit = { root = { has_character_modifier = roman_consul_east } }
			senate_election_effect = {
				REGION = east
				LOCATION = constantinople
				BARONY = b_constantinople
			}
		}
		if = {
			limit = { root = { has_character_modifier = roman_consul_west } }
			senate_election_effect = {
				REGION = west
				LOCATION = rome
				BARONY = b_roma
			}
		}
	}
}

# character having its birthday in root scope
# tested after age has increased
on_birthday = {
	on_actions = {
		senate_on_25th_birthday
	}
}

#Age for Senators based on Augustus' law (last I can see it changing)
senate_on_25th_birthday = {
	trigger = {
		exists = root.dynasty
		valid_to_be_senator_sex = { CHAR = root }
		valid_to_be_senator_age = { CHAR = root }
	}
	effect = {
		if = {
			limit = { dynasty = { has_dynasty_modifier = roman_senate_family_west } }
			trigger_event = { id = BP_roman_government_events.0051 }
		}
		if = {
			limit = { dynasty = { has_dynasty_modifier = roman_senate_family_east } }
			trigger_event = { id = BP_roman_government_events.1051 }
		}
	}
}


# root = the new holder
# scope:title = the title that changes hands
# scope:previous_holder = previous holder. Might be dead
on_title_gain = {
	events = {}
	on_actions = {
		BP_emperors_get_early_senate_hood
	}
}

#Roman Emperors are automatically Senators, regardless of age.
BP_emperors_get_early_senate_hood = {
	trigger = { valid_to_be_senator_roman_empires = { CHAR = root } }
	effect = {
		if = {
			limit = {
				any_sub_realm_barony = { this = title:b_roma }
				NOT = { has_trait = senator_west }
			}
			add_trait = senator_west
		}
		if = {
			limit = {
				any_sub_realm_barony = { this = title:b_constantinople }
				NOT = { has_trait = senator_east }
			}
			add_trait = senator_east
		}
	}
}

# A title is lost by a character
# root = the old holder
# scope:title = the title that changes hands
# scope:new_holder = new holder.
on_title_lost = {
	on_actions = { BP_no_longer_supported_by_the_senate }
}

BP_no_longer_supported_by_the_senate = {
	trigger = { root = { has_character_modifier = approved_by_the_senate } }
	effect = {
		if = { #If a player game overs, remove the support; no need for event in this case
			limit = { is_landed = no }
			remove_character_modifier = approved_by_the_senate
		}
		else_if = {
			limit = { is_independent_ruler = no }
			trigger_event = { id = BP_roman_government_events.2001 days = { 1 3 } }
		}
		else_if = {
			limit = {
				OR = {
					NOT = { any_sub_realm_barony = { this = title:b_roma } }
					NOT = { any_sub_realm_barony = { this = title:b_constantinople } }
				}
			}
			trigger_event = { id = BP_roman_government_events.2002 days = { 3 7 } }
		}
	}
}