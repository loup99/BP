# character just about to die in root scope
# if a killer is know, it's set as scope:killer
#Triggered by code
on_death = {
	on_actions = {
		BP_handle_roman_succession
		bp_shatter_tribal_peoples_without_leges_barbarorum
	}
}

BP_handle_roman_succession = {
	effect = {
		if = {
			limit = {
				has_realm_law = roman_administrative_law
				is_independent_ruler = no #The Emperor keeps his titles
			}
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change_titles_taken
				add_claim_on_loss = no
			}
			
			every_held_title = {
				limit = {
					OR = {
						this.tier = tier_kingdom
						this.tier = tier_duchy
						AND = {
							this.tier = tier_county
							NOT = { this.county = root.capital_county }
						}
						AND = {
							this.tier = tier_barony
							NOT = { this.county = root.capital_county }
						}
					}
				}
				add_to_temporary_list = non_capital_titles
			}
			every_in_list = {
				list = non_capital_titles
				change_title_holder = {
					holder = root.top_liege
					change = scope:change_titles_taken
				}
			}
			resolve_title_and_vassal_change = scope:change_titles_taken
		}
	}
}

bp_shatter_tribal_peoples_without_leges_barbarorum = {
	effect = {
		if = {
			limit = {
				has_game_rule = tribal_shatter_mechanic_enabled
				root = { has_government = tribal_government }
				NOT = { root.culture = { has_innovation = innovation_social_stratification } }
				root.primary_title.tier >= tier_kingdom
			}
			every_held_title = {
				limit = { this.tier >= tier_kingdom }
				root = { destroy_title = prev }
			}
		}
	}
}
