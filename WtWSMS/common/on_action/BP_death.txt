# character just about to die in root scope
# if a killer is know, it's set as scope:killer
#Triggered by code
on_death = {
	on_actions = {
		bp_release_tributaries
		bp_shatter_tribal_peoples_without_leges_barbarorum
	}
}

bp_release_tributaries = {
	effect = {
		root = {
			every_vassal = {
				limit = { this = { vassal_contract_has_flag = tributary_installed_flag } }
				create_title_and_vassal_change = {
					type = independency
					save_scope_as = change
					add_claim_on_loss = yes
				}
				becomes_independent = { change = scope:change }
				resolve_title_and_vassal_change = scope:change
			}
		}
	}
}

bp_shatter_tribal_peoples_without_leges_barbarorum = {
	effect = {
		if = {
			limit = {
				has_game_rule = tribal_shatter_mechanic_enabled
				root = { has_government = tribal_government }
				NOT = { root.culture = { has_innovation = innovation_social_stratification } }
				root.primary_title.tier >= tier_kingdom
			}
			every_held_title = {
				limit = { this.tier >= tier_kingdom }
				root = { destroy_title = prev }
			}
		}
	}
}
