on_game_start = {
	on_actions = {
		set_minorities_game_start
		BP_set_minorities_universal
		BP_set_minorities_by_date
	}
}

on_game_start_after_lobby = {
	on_actions = {
		initial_spawn_minority_courtiers
	}
}

##### Changed from Vanilla: Removed various religions based on WtWSMS status, added WtWSMS cases

# culture_minorities_large
# culture_minorities_small
# faith_minorities_large
# faith_minorities_small

set_minorities_game_start = {
	effect = {
		title:c_kerala = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}
		##### TODO FIXME!!!!
#		title:c_eranad = {
#			add_to_variable_list = {
#				name = culture_minorities_small
#				target = culture:kochinim
#			}
#			add_to_variable_list = {
#				name = faith_minorities_small
#				target = faith:malabarism
#			}
#		}
		##### TODO FIXME!!!!
		title:c_alupa = {
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:kochinim
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:malabarism
			}
		}

		title:c_kanara = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}
		title:c_panaji = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nestorian
			}
		}

		title:c_marsabit = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:urartuism
			}
		}
		title:c_fudalhi = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:urartuism
			}
		}

		##### Changed from Vanilla: Removed Yazidis

		# Manichean

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
		}

		##### Changed from Vanilla: Removed Ash'ari

		# Jewish

		title:c_shazhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_liangzhou = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}

		# Parsees

		title:c_daman = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:mazdayasna
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:persian
			}
		}
	}
}

BP_set_minorities_universal = {
	effect = {
		#e_khazaria
		title:c_durdzukia = { #Mountain Jews
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:tzadikite
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:juhuro
			}
		}
		
		#e_armenia
		title:c_derbent = { #Mountain Jews
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:tzadikite
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:juhuro
			}
		}
		#Georgian Jews
		title:c_kakheti = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:gruzinim
			}
		}
		title:c_tbilisi = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:gruzinim
			}
		}
		title:c_kartli = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:gruzinim
			}
		}
		
		#e_byzantium
		##k_byzantium
		title:c_byzantion = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		##k_asia
		###Jewish presence on the Aegean Coast
		title:c_aeolis = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		title:c_ionia = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
		}
		##k_oriens
		###Israel
		every_county = {
			limit = {
				OR = {
					this.duchy = title:d_iudea
					this.culture = culture:hebrew
				}
			}
			this = {
				#Faiths
				if = {
					limit = { NOT = { this.faith = faith:rabbinism } }
					add_to_variable_list = {
						name = faith_minorities_large
						target = faith:rabbinism
					}
				}
				if = {
					limit = { NOT = { this.faith = faith:samaritan } }
					add_to_variable_list = {
						name = faith_minorities_small
						target = faith:samaritan
					}
				}
			}
		}
		title:c_jerusalem = {
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:miaphysitism
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:aramean
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:greek
			}
		}
		###Others
		title:c_harran = {
			#Faiths
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:platonism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:hellenic_pagan
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:assyrian_pagan
			}
			#Cultures
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:greek
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:aramean
			}
		}
		##k_egypt
		title:c_alexandria = {
			if = {
				limit = { NOT = { this.faith = faith:miaphysitism } }
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:miaphysitism
				}
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:karaism
			}
		}
		
		#e_persia
		##k_asoristan
		title:c_baghdad = {
			#Faiths
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:mazdayasna
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:manichean
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:rabbinism
			}
			add_to_variable_list = {
				name = faith_minorities_small
				target = faith:nicene
			}
			#Cultures
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:persian
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:hebrew
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:assyrian
			}
			add_to_variable_list = {
				name = culture_minorities_small
				target = culture:greek
			}
		}
		
		#e_north_africa
		##k_tripolitania
		title:c_syrte = { #Long Attested Non-Berber language presence by al-Bakri
			add_to_variable_list = {
				name = culture_minorities_large
				target = culture:punic
			}
		}
		#Religious admixture of Donatists/Nicenes in Carthage/Numidia/Sitifensis
		every_county = {
				limit = {
					OR = {
						this.duchy = title:d_carthago
						this.duchy = title:d_numidia
						this.duchy = title:d_sitifensis
						this = title:c_gabes
						this = title:c_souf
					}
				}
				this = {
					#Faiths
					if = {
						limit = { NOT = { this.faith = faith:african_church } }
						add_to_variable_list = {
							name = faith_minorities_small
							target = faith:african_church
						}
					}
					if = {
						limit = { NOT = { this.faith = faith:donatism } }
						add_to_variable_list = {
							name = faith_minorities_small
							target = faith:donatism
						}
					}
				}
			}
	}
}

BP_set_minorities_by_date = {
	effect = {
		if = {
			limit = { current_date <= 500.1.1 }
			
			#e_armenia
			title:c_abkhazia = { #Abkhaz Christians
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:georgian_orthodox
				}
			}
			
			#e_gaul
			title:c_provence = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:massalian
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:nicene
				}
			}
			
			#e_byzantium
			##k_byzantium
			title:c_byzantion = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:miaphysitism
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:rabbinism
				}
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:roman
				}
			}
			##k_pontus
			title:c_trebizond = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:georgian_pagan
				}
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:macronian
				}
			}
			##k_hellas
			title:c_attica = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:platonism
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:hellenic_pagan
				}
			}
			##k_asia
			title:c_phrygia = { #Remnant Phrygians
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:phrygian
				}
			}
			title:c_pacatiana = { #Remnant Phrygian Ostrogoths (cf. Claudian, Zosimus)
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:gothic_church
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:gothic
				}
			}
			
			##k_thrace
			title:c_nikopolis = {
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:gothic_church
				}
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:thracian_gothic
				}
			}
			##k_cilicia
			title:c_alexandretta = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:maronite_church
				}
			}
			##k_oriens
			title:c_baalbek = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:maronite_church
				}
			}
			title:c_beirut = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:apollinarism
				}
			}
			title:c_tripoli = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:maronite_church
				}
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:syrian_orthodox
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:apollinarism
				}
			}
			title:c_acre = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:apollinarism
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:maronite_church
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:romano_aramean
				}
			}
			title:c_aintab = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:maronite_church
				}
			}
			title:c_marash = {
				#Faiths
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:maronite_church
				}
				#Cultures
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:aramean
				}
			}
			###Israel
			every_county = {
				limit = { this.duchy = title:d_iudea }
				this = {
					#Faiths
					if = {
						limit = { NOT = { this.faith = faith:nicene } }
						add_to_variable_list = {
							name = faith_minorities_small
							target = faith:nicene
						}
					}
					if = {
						limit = { NOT = { this.faith = faith:ebionite } }
						add_to_variable_list = {
							name = faith_minorities_small
							target = faith:ebionite
						}
					}
				}
			}
			title:c_jerusalem = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:monophysitism
				}
			}
			title:c_ghazza = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:mazdayasna
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:persian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:greek
				}
			}
			
			#e_north_africa
			##k_africa
			title:c_tunis = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:rabbinism
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:vandalic
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:punic
				}
			}
			title:c_melilla = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:african_church
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:romano_african
				}
			}
			title:c_gharb = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:african_church
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:romano_african
				}
			}
			#Coastal provinces of Caesariensis
			every_county = {
				limit = {
					this.duchy = title:d_caesariensis
					is_coastal_county = yes
				}
				this = {
					#Faiths
					if = {
						limit = { NOT = { this.faith = faith:african_church } }
						add_to_variable_list = {
							name = faith_minorities_large
							target = faith:african_church
						}
					}
					#Cultures
					if = {
						limit = { NOT = { this.culture = culture:romano_african } }
						add_to_variable_list = {
							name = culture_minorities_large
							target = culture:romano_african
						}
					}
				}
			}
			
			#e_persia
			##k_persia
			title:c_tustar = { #Gondishapur, Susa, &c. a Cosmopolitan region
				#Faith
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:nestorian
				}
				add_to_variable_list = { #Roman captives after Shapur II rebuilt the city
					name = faith_minorities_small
					target = faith:nicene
				}
				add_to_variable_list = { #Remnant Greek Polytheism of the time
					name = faith_minorities_small
					target = faith:hellenic_pagan
				}
				#Culture
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:aramean
				}
				add_to_variable_list = { #Roman captives after Shapur II rebuilt the city
					name = culture_minorities_small
					target = culture:roman
				}
				add_to_variable_list = { #Ancient Greek settlement in Susa
					name = culture_minorities_small
					target = culture:greek
				}
			}
			title:c_abbadan = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:mazdayasna
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:persian
				}
			}
			title:c_ahvaz = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:mazdayasna
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:persian
				}
			}
			###Remnant Medians
			title:c_hamadan = {
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:median
				}
			}
			title:c_nihawand = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:median
				}
			}
			title:c_kermanshah = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:median
				}
			}
			title:c_masbadhan = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:median
				}
			}
			title:c_saimara = {
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:median
				}
			}
			##k_daylam
			title:c_urmiya = {
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:armenian_apostolic
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:nestorian
				}
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:manichean
				}
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:armenian
				}
			}
			title:c_talish = {
				add_to_variable_list = {
					name = faith_minorities_large
					target = faith:manichean
				}
			}
			
			#e_spain
			##k_cartaginensis
			every_county = { #Alans in Carthaginense
				limit = {
					OR = {
						this.duchy = title:d_carthago_inferior
						this.duchy = title:d_carthago_superior
					}
				}
				this = {
					add_to_variable_list = {
						name = faith_minorities_small
						target = faith:arian
					}
					add_to_variable_list = {
						name = culture_minorities_small
						target = culture:alan
					}
				}
			}
			##k_lusitania
			### Alentejo Alans
			title:c_alcacer_do_sal = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			title:c_alpesa = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			title:c_beja = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			title:c_moura = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			title:c_badajoz = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			title:c_lisboa = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:alan
				}
			}
			##k_gallaecia
			title:c_porto = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = { #Terras de Boro
					name = culture_minorities_small
					target = culture:buri
				}
			}
			title:c_santiago = {
				add_to_variable_list = {
					name = faith_minorities_small
					target = faith:arian
				}
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:macromanni
				}
			}
			
			#e_gaul
			##k_septem_provincae
			title:c_limousin = { #Taphaleschat
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:taifal
				}
			}
			title:c_quercy = { #Touffailles and Touffaillou
				add_to_variable_list = {
					name = culture_minorities_large
					target = culture:taifal
				}
			}
			title:c_lyon = { #Taïfailia
				add_to_variable_list = {
					name = culture_minorities_small
					target = culture:taifal
				}
			}
		}
	}
}

initial_spawn_minority_courtiers = {
	effect = {
		every_ruler = { trigger_event = { on_action = spawn_minority_characters } }
	}
}
