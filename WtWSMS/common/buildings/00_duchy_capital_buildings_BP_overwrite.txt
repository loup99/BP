##### Changed from Vanilla: ancient urbanites unlock the first level of duchy buildings
##### Changed from Vanilla: megaliths requires social stratification innovation as well

##########
# Duchy Capital Buildings
# These are built in the first barony of the first county of any duchy
# Holding the associated duchy is required both to build, and for the buildings to be enabled
##########

# SPECIAL DUCHY BUILDINGS
# We place these at the top to make them more visible in the building interface.

royal_garden_01 = {
	construction_time = slow_construction_time
	effect_desc = royal_garden_effect_desc

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
		culture = { has_cultural_parameter = enable_garden_duchy_building }
		NOR = {
			terrain = desert_mountains
			terrain = mountains
			terrain = wetlands
		}
	}
	
	can_construct_showing_failures_only = { duchy_building_economic_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		monthly_prestige_gain_mult = 0.05
		stress_gain_mult = -0.10
		#Add a court grandeur bonus
		court_grandeur_baseline_add = 4
		#character_capital_county_monthly_development_growth_add = 0.2
	}
	duchy_capital_county_modifier = {
		county_opinion_add = 5
	}
	province_modifier = {
		monthly_income = good_building_tax_tier_2
	}
	
	next_building = royal_garden_02

	type_icon = "icon_building_royal_forest.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

# REGULAR DUCHY BUILDINGS

military_academy_01 = {
	construction_time = slow_construction_time
	effect_desc = academies_effect_desc

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		knight_limit = 2
		knight_effectiveness_mult = 0.25
		army_maintenance_mult = -0.025
		men_at_arms_recruitment_cost = -0.1
		men_at_arms_limit = 1
	}
	
	next_building = military_academy_02
	
	type_icon = "icon_building_military_academy.dds"

	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

march_01 = {
	construction_time = slow_construction_time

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	duchy_capital_county_modifier = {
		supply_limit_mult = 0.25
		levy_reinforcement_rate = 0.25
		garrison_size = 0.25
		hostile_raid_time = 0.2
		defender_holding_advantage = 5
		additional_fort_level = normal_building_fort_level_tier_2
		travel_danger = -10
		mountains_tax_mult = 0.15
		desert_mountains_tax_mult = 0.15
		hills_tax_mult = 0.15
	}
	
	next_building = march_02

	type_icon = "icon_building_march.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		culture_likely_to_fortify_modifier = yes
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

siege_works_01 = {
	construction_time = slow_construction_time

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		siege_weapon_recruitment_cost_mult = -0.15
		siege_weapon_maintenance_mult = -0.15
	}
	province_modifier = {
		stationed_siege_weapon_siege_value_mult = very_high_maa_siege_value_tier_1
		stationed_siege_weapon_toughness_add = 5
	}
	duchy_capital_county_modifier = {
		additional_fort_level = normal_building_fort_level_tier_2
	}
	
	next_building = siege_works_02

	type_icon = "icon_building_siege_works.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		culture_likely_to_fortify_modifier = yes
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

royal_armory_01 = {
	construction_time = slow_construction_time
	effect_desc = {
		triggered_desc = {
			trigger = { has_dlc_feature = tours_and_tournaments }
			desc = tournament_activity_cost_max_discount_effect_desc
		}
	}
	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	duchy_capital_county_modifier = {
		levy_size = 0.2
	}
	
	character_modifier = {
		army_maintenance_mult = -0.025
	}
	
	province_modifier = {
		stationed_maa_damage_mult = normal_maa_damage_tier_1
		stationed_maa_toughness_mult = normal_maa_toughness_tier_1
	}

	character_culture_modifier = {
		parameter = better_armory_buildings
		prowess = 2
		knight_effectiveness_mult = 0.15
	}

	duchy_capital_county_culture_modifier = {
		parameter = better_armory_buildings
		build_gold_cost = -0.1
		holding_build_gold_cost = -0.1
	}
	
	next_building = royal_armory_02

	type_icon = "icon_building_royal_armory.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

jousting_lists_01 = {
	construction_time = slow_construction_time
	effect_desc = {
		triggered_desc = {
			trigger = { has_dlc_feature = tours_and_tournaments }
			desc = unlocks_building_desc
		}
		triggered_desc = {
			trigger = { has_dlc_feature = tours_and_tournaments }
			desc = tournament_horse_cost_discount_effect_toto_desc
		}
	}
	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		men_at_arms_maintenance = -0.06
	}
	
	province_modifier = {
		stationed_heavy_cavalry_damage_mult = very_high_maa_damage_tier_1
		stationed_heavy_cavalry_toughness_mult = very_high_maa_toughness_tier_1
		stationed_heavy_cavalry_screen_mult = very_high_maa_screen_tier_1
		stationed_heavy_cavalry_pursuit_mult = very_high_maa_pursuit_tier_1
		stationed_light_cavalry_damage_mult = high_maa_damage_tier_1
		stationed_light_cavalry_toughness_mult = high_maa_toughness_tier_1
		stationed_light_cavalry_screen_mult = high_maa_screen_tier_1
		stationed_light_cavalry_pursuit_mult = high_maa_pursuit_tier_1
		stationed_elephant_cavalry_damage_mult = very_high_maa_damage_tier_1
		stationed_elephant_cavalry_toughness_mult = very_high_maa_toughness_tier_1
		stationed_camel_cavalry_damage_mult = high_maa_damage_tier_1
		stationed_camel_cavalry_toughness_mult = high_maa_toughness_tier_1
		stationed_camel_cavalry_screen_mult = high_maa_screen_tier_1
		stationed_camel_cavalry_pursuit_mult = high_maa_pursuit_tier_1
	}
	
	next_building = jousting_lists_02

	type_icon = "icon_building_jousting_lists.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		ai_anti_synergy_armored_infantry_modifier = yes
		ai_anti_synergy_light_infantry_modifier = yes
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Don't build unsuitable MaA-boosting duchy buildings
			factor = 0
			scope:holder = {
				NOR = {
					number_maa_regiments_of_base_type = {
						type = heavy_cavalry
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = light_cavalry
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = elephant_cavalry
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = camel_cavalry
						value > 0
					}
				}
			}
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

blacksmiths_01 = {
	construction_time = slow_construction_time
	effect_desc = {
		desc = unlocks_building_desc
		triggered_desc = {
			trigger = { has_dlc_feature = tours_and_tournaments }
			desc = blacksmiths_toto_effect_desc
		}
		triggered_desc = {
			trigger = { has_dlc_feature = royal_court }
			desc = blacksmiths_roco_effect_desc
		}
		desc = blacksmiths_effect_desc
	}

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		men_at_arms_maintenance = -0.06
	}
	
	province_modifier = {
		stationed_pikemen_damage_mult = normal_maa_damage_tier_1
		stationed_pikemen_toughness_mult = very_high_maa_toughness_tier_1
		stationed_heavy_infantry_damage_mult = normal_maa_damage_tier_1
		stationed_heavy_infantry_toughness_mult = very_high_maa_toughness_tier_1
	}

	character_culture_modifier = {
		parameter = better_blacksmith_buildings
		pikemen_toughness_mult = 0.03
		heavy_infantry_toughness_mult = 0.03
		prowess = 2
	}

	duchy_capital_county_culture_modifier = {
		parameter = better_blacksmith_buildings
		supply_limit_mult = 0.25
	}

	
	next_building = blacksmiths_02

	type_icon = "icon_building_blacksmiths.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		ai_anti_synergy_cavalry_modifier = yes
		ai_anti_synergy_light_infantry_modifier = yes
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Don't build unsuitable MaA-boosting duchy buildings
			factor = 0
			scope:holder = {
				NOR = {
					number_maa_regiments_of_base_type = {
						type = pikemen
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = heavy_infantry
						value > 0
					}
				}
			}
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

archery_ranges_01 = {
	construction_time = slow_construction_time
	effect_desc = {
		triggered_desc = {
			trigger = { has_dlc_feature = tours_and_tournaments }
			desc = tournament_archery_cost_discount_effect_toto_desc
		}
	}
	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_military_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		men_at_arms_maintenance = -0.06
	}
	
	province_modifier = {
		stationed_archers_damage_mult = very_high_maa_damage_tier_1
		stationed_archers_toughness_mult = low_maa_toughness_tier_1
		stationed_skirmishers_screen_mult = high_maa_screen_tier_1
		stationed_skirmishers_damage_mult = very_high_maa_damage_tier_1
		stationed_skirmishers_toughness_mult = high_maa_toughness_tier_1
		stationed_skirmishers_pursuit_mult = high_maa_pursuit_tier_1
		stationed_archer_cavalry_screen_mult = high_maa_screen_tier_1
		stationed_archer_cavalry_damage_mult = high_maa_damage_tier_1
		stationed_archer_cavalry_toughness_mult = low_maa_toughness_tier_1
		stationed_archer_cavalry_pursuit_mult = high_maa_pursuit_tier_1
	}
	
	next_building = archery_ranges_02

	type_icon = "icon_building_royal_hunting_grounds.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		ai_anti_synergy_cavalry_modifier = yes
		ai_anti_synergy_armored_infantry_modifier = yes
		modifier = {
			add = 10
			scope:holder = {
				number_maa_regiments_of_base_type = {
					type = archer_cavalry
					value >= 2
				}
			}
		}
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Don't build unsuitable MaA-boosting duchy buildings
			factor = 0
			scope:holder = {
				NOR = {
					number_maa_regiments_of_base_type = {
						type = archers
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = skirmishers
						value > 0
					}
					number_maa_regiments_of_base_type = {
						type = archer_cavalry
						value > 0
					}
				}
			}
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

tax_assessor_01 = {
	construction_time = slow_construction_time

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_economic_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	duchy_capital_county_modifier = {
		tax_mult = 0.15
	}
	
	next_building = tax_assessor_02

	type_icon = "icon_building_tax_assessor.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = {
			factor = 2
			AND = {
				building_watermills_requirement_terrain = yes
				building_windmills_requirement_terrain = yes
			}
		}
		modifier = {
			factor = 2
			OR = {
				has_building_or_higher = watermills_01
				has_building_or_higher = windmills_01
				has_building_or_higher = caravanserai_01
			}
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

leisure_palace_01 = {
	construction_time = slow_construction_time
	effect_desc = leisure_palace_effect_desc

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
	}
	
	can_construct_showing_failures_only = { duchy_building_economic_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	character_modifier = {
		monthly_prestige_gain_mult = 0.05
		stress_loss_mult = 0.15
		owned_hostile_scheme_success_chance_add = 5
		owned_personal_scheme_success_chance_add = 5
	}
	
	duchy_capital_county_modifier = {
		monthly_county_control_change_factor = 0.2
		monthly_county_control_change_add = 0.2
	}
	
	next_building = leisure_palace_02

	type_icon = "icon_building_leisure_palace.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 10
		
		modifier = { # This type of Duchy Capital Building should be more rare
			add = 10
			scope:holder = {
				OR = { # Suitable personality; cares a lot about their image or reclusive
					has_trait = arrogant
					has_trait = deceitful
					has_trait = paranoid
					has_trait = shy
					has_trait = lazy
					has_trait = reclusive
					has_trait = profligate
				}
			}
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

royal_forest_01 = {
	construction_time = slow_construction_time
	effect_desc = royal_reserves_desc

	can_construct_potential = {
		building_requirement_castle_city_church = { LEVEL = 01 }
		building_requirement_tribal = no
		NOR = {
			terrain = steppe
			terrain = desert
			terrain = oasis
			terrain = desert_mountains
			terrain = mountains
			terrain = wetlands
		}
	}
	
	can_construct_showing_failures_only = { duchy_building_economic_level_01_trigger = yes }
	
	is_enabled = {
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost
	
	duchy_capital_county_modifier = {
		county_opinion_add = 5
		development_growth_factor = 0.1
	}
	province_modifier = {
		monthly_income = good_building_tax_tier_2
	}
	
	next_building = royal_forest_02

	type_icon = "icon_building_royal_forest.dds"
	
	type = duchy_capital
	
	ai_value = {
		base = 20
		modifier = {
			factor = 2
			scope:holder.capital_province = this
		}
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
}

##########
# Megalith
##########
great_megalith_01 = {

	construction_time = very_slow_construction_time

	type_icon = "icon_megalith.dds"
	
	can_construct_potential = {
		building_requirement_tribal = no
		building_requirement_castle_city_church = { LEVEL = 01 }
		scope:holder = { faith = { has_doctrine_parameter = can_build_megaliths } }
		duchy_building_religion_level_01_trigger = yes
	}
	
	is_enabled = {
		custom_tooltip = {
			text = province_is_of_a_megalith_faith_tt
			county.faith = { has_doctrine_parameter = can_build_megaliths }
		}
		county.holder = { has_title = prev.duchy }
	}
	show_disabled = yes
	
	cost_gold = expensive_building_tier_3_cost

	character_modifier = {
		monthly_learning_lifestyle_xp_gain_mult = 0.1
		monthly_piety = 0.25
		monthly_dynasty_prestige_mult = 0.05
		naval_movement_speed_mult = 0.1
	}

	duchy_capital_county_modifier = {
		county_opinion_add = 10
		development_growth_factor = 0.15
	}
	
	province_modifier = {
		monthly_income = good_building_tax_tier_3
	}
	
	ai_value = {
		base = 100
		modifier = { # Fill all building slots before going for duchy buildings
			factor = 0
			free_building_slots > 0
		}
	}
	
	type = duchy_capital

	flag = fully_upgraded_duchy_capital_building
}
