clean_up_map_modes = {
	effect = {
		every_county = { reset_color_effect = yes }
	}
}

highlight_tributaries_map = {
	effect = {
		if = {
			limit = { NOT = { global_var:custom_map_mode = flag:highlight_tributaries_map } }
			set_global_variable = {
				name = custom_map_mode_changing
				value = 1
			}
			set_global_variable = {
				name = custom_map_mode
				value = flag:highlight_tributaries_map
			}
			#Actual colouration
			every_ruler = {
				limit = { is_independent_ruler = yes }
				#If a suzerain, color from primary_title
				if = {
					limit = { is_suzerain = yes }
					every_sub_realm_county = { set_color_from_title = this.holder.top_liege.primary_title }
				}
				else_if = {
					limit = { is_tributary = yes }
					every_sub_realm_county = { set_color_from_title = this.holder.top_liege.var:my_suzerain.primary_title }
				}
				else = { every_sub_realm_county = { set_color_from_title = title:d_map_base_color } }
			}
			remove_global_variable = custom_map_mode_changing
		}
	}
	is_shown = {
		exists = global_var:custom_map_mode
		global_var:custom_map_mode = flag:highlight_tributaries_map
	}
	is_valid = { NOT = { exists = global_var:custom_map_mode_changing } }
}