culture_conversion_acceptance_impact = { #The smaller a culture is, the more upset it will be.
	subtract = {
		value = 1
		divide = {
			value = scope:county.culture.culture_number_of_counties
			min = 1
		}
		multiply = 15 #Same as used in grant above

		# Due to minority system
		divide = 3
		min = 0.1
		max = 5
	}
}
##### Changed from Vanilla vvvvv

##### Event Frequency Values

#Assuming you know how many years Y you want a P% of a minority spread, you can 
#calculate as P = (1-X)^Y, for P the chance of minority spread
# So here's a quick look-up table:
#
#  P  |   X   |  Y  
#-----|-------|-----
# 50% | 12.9% |  05 
# 50% | 6.70% |  10 
# 50% | 2.73% |  25 
# 50% | 1.38% |  50 
# 50% | 1.00% |  70 

chance_of_minority_immigration_event_per_year = 2.73

chance_of_culture_minority_reduction_event_per_year = 12.9
chance_of_culture_minority_underfed_event_per_year = 2.73

chance_of_faith_minority_reduction_event_per_year = 12.9
chance_of_faith_minority_underfed_event_per_year = 2.73

chance_of_faith_majority_evangelization_event_per_year = 2.73

chance_of_majority_growth_event_per_year = 1.38
#NB: this will be additionally weighted by the the difference in development between the 
#target and the source. This just controls the probabilty that a specific county will get checked to
#try and migrate per year
chance_of_outward_immigration_event_per_year = 6.70

##### Councillor Action Speed

#This is the rate when it is **not** your faith
minority_faith_conversion_speed = {
	value = number_of_minority_levels
	### Add additional speed-up/slow-down effects here
	if = { #Minor Migration Effects
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_minor_migration_minor_aristocracy }
		}
		multiply = {
			value = convert_faith_minor_migration_minor_aristocracy_penalty
			desc = COURT_CHAPLAIN_FAITH_MINOR_ARISTOCRACY
		}
	}
	if = { #Major migration effect
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_migration_recent_immigration }
		}
		multiply = {
			value = conversion_recent_immigration_bonus
			desc = COURT_CHAPLAIN_CONVERSION_RECENTLY_MIGRATED_TO
		}
	}
	if = { # Depopulated regions are easy to settle
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_migration_recent_emigration }
		}
		multiply = {
			value = conversion_recent_emigration_bonus
			desc = COURT_CHAPLAIN_CONVERSION_RECENTLY_MIGRATED_AWAY
		}
	}
}
#This is the rate when it **is** your faith
converting_faith_minority_in_majority_province_speed_reduction = {
	value = default_only_minority_faith_speed_reduction
	### Add additional speed-up/slow-down effects here
}

#This is the rate when it is **not** your culture
minority_culture_conversion_speed = {
	value = number_of_minority_levels
	### Add additional speed-up/slow-down effects here
	if = { #Minor Migration Effects
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_minor_migration_minor_aristocracy }
		}
		multiply = {
			value = promote_culture_minor_migration_minor_aristocracy_penalty
			desc = STEWARD_PROMOTE_CULTURE_MINOR_ARISTOCRACY
		}
	}
	if = { #Recent major migration makes settling easier
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_migration_recent_immigration }
		}
		multiply = {
			value = promote_culture_recent_immigration_bonus
			desc = STEWARD_PROMOTE_CULTURE_RECENTLY_MIGRATED_TO
		}
	}
	if = { # Depopulated regions are easy to settle
		limit = {
			exists = scope:county
			scope:county = { has_county_modifier = county_modifier_migration_recent_emigration }
		}
		multiply = {
			value = promote_culture_recent_emigration_bonus
			desc = COURT_CHAPLAIN_CONVERSION_RECENTLY_MIGRATED_AWAY
		}
	}
}
#This is the rate when it **is** your culture
converting_culture_minority_in_majority_province_speed_reduction = {
	value = default_only_minority_culture_speed_reduction
	### Add additional speed-up/slow-down effects here
}

##### Minority Capacity & Utilization

#County Scope
minority_capacity_of_county = {
	# Every county can support minorities as a function of its development; We will utilize the Lucas
	# Sequence Vn(1,−1) [the Lucas Numbers, a series related to the Fibonacci sequence]
	# 1, 3, 4, 7, 11, 18, 29, 47, 76 ...
	value = 1
	if = { #Only non-tribal counties should support more than one minority
		limit = { this = { has_a_non_tribal_holding_trigger = yes } }
		if = { limit = { this.development_level >= 04 } add = 1 }
		if = { limit = { this.development_level >= 07 } add = 1 }
		if = { limit = { this.development_level >= 11 } add = 1 }
		if = { limit = { this.development_level >= 18 } add = 1 }
		if = { limit = { this.development_level >= 29 } add = 1 }
		if = { limit = { this.development_level >= 47 } add = 1 }
		if = { limit = { this.development_level >= 76 } add = 1 }
	}
}
minority_capacity_of_county_culture = {
	value = minority_capacity_of_county
	### Additional Effects between here vvv
	### Additional Effects between here ^^^
	min = 1
}
minority_capacity_of_county_faith = {
	value = minority_capacity_of_county
	### Additional Effects between here vvv
	### Additional Effects between here ^^^
	min = 1
}
#County Scope
culture_small_minority_weight_value = {
	value = base_small_minority_weight
	if = {
		limit = { scope:the_county_temp.culture = { has_a_culture_blending_tradition_trigger = yes } }
		multiply = tradition_culture_blending_multiplier
	}
	if = {
		limit = {
			scope:the_culture_temp = { has_reduced_weight_in_rough_terrain_trigger = yes }
			scope:the_county_temp = { has_a_rough_terrain_province_trigger = yes }
		}
		multiply = tradition_rough_terrain_diversity_multiplier
	}
}
culture_large_minority_weight_value = {
	value = base_large_minority_weight
	if = {
		limit = { scope:the_county_temp.culture = { has_a_culture_blending_tradition_trigger = yes } }
		multiply = tradition_culture_blending_multiplier
	}
	if = {
		limit = {
			scope:the_culture_temp = { has_reduced_weight_in_rough_terrain_trigger = yes }
			scope:the_county_temp = { has_a_rough_terrain_province_trigger = yes }
		}
		multiply = tradition_rough_terrain_diversity_multiplier
	}
}
number_of_culture_minorities_in_county_weighted = {
	this = { save_temporary_scope_as = the_county_temp }
	value = 0
	if = {
		limit = { this = { has_variable_list = culture_minorities_small } }
		this = {
			every_in_list = {
				variable = culture_minorities_small
				this = { save_temporary_scope_as = the_culture_temp }
				add = culture_small_minority_weight_value
			}
		}
	}
	if = {
		limit = { this = { has_variable_list = culture_minorities_large } }
		this = {
			every_in_list = {
				variable = culture_minorities_large
				this = { save_temporary_scope_as = the_culture_temp }
				add = culture_large_minority_weight_value
			}
		}
	}
}
#County Scope
faith_small_minority_weight_value = {
	value = base_small_minority_weight
	if = {
		limit = {
			scope:the_county_temp.faith = { is_dharmic_faith_trigger = yes }
			scope:the_faith_temp = { has_reduced_weight_in_dharmic_counties_trigger = yes }
		}
		multiply = dharmic_minorities_in_dharmic_counties_multiplier
	}
	else_if = {
		limit = { scope:the_county_temp.culture = { has_a_religion_blending_tradition_trigger = yes } }
		multiply = tradition_religion_blending_multiplier
	}
}
faith_small_minority_weight_value = {
	value = base_small_minority_weight
	if = {
		limit = {
			scope:the_county_temp.faith = { is_dharmic_faith_trigger = yes }
			scope:the_faith_temp = { has_reduced_weight_in_dharmic_counties_trigger = yes }
		}
		multiply = dharmic_minorities_in_dharmic_counties_multiplier
	}
	else_if = {
		limit = { scope:the_county_temp.culture = { has_a_religion_blending_tradition_trigger = yes } }
		multiply = tradition_religion_blending_multiplier
	}
}
faith_large_minority_weight_value = {
	value = base_large_minority_weight
	if = {
		limit = {
			scope:the_county_temp.faith = { is_dharmic_faith_trigger = yes }
			scope:the_faith_temp = { has_reduced_weight_in_dharmic_counties_trigger = yes }
		}
		multiply = dharmic_minorities_in_dharmic_counties_multiplier
	}
	if = {
		limit = { scope:the_county_temp.culture = { has_a_religion_blending_tradition_trigger = yes } }
		multiply = tradition_religion_blending_multiplier
	}
}
number_of_faith_minorities_in_county_weighted = {
	this = { save_temporary_scope_as = the_county_temp }
	value = 0
	if = { #Small minorities
		limit = { this = { has_variable_list = faith_minorities_small } }
		every_in_list = {
			variable = faith_minorities_small
			this = { save_temporary_scope_as = the_faith_temp }
			add = faith_small_minority_weight_value
		}
	}
	if = { #Large minorities
		limit = { this = { has_variable_list = faith_minorities_large } }
		this = {
			every_in_list = {
				variable = faith_minorities_large
				this = { save_temporary_scope_as = the_faith_temp }
				add = faith_small_minority_weight_value
			}
		}
	}
}

### Minority Support Values
#Note that the values are less than zero to keep the ordering algorithms simple
#Also, presumes the scope `the_county` has been set

#Culture Support Determination
support_of_a_culture_minority_in_county = {
	this = { save_temporary_scope_as = the_culture }
	value = support_of_a_minority_culture_generic
	### Additional, TC-specific features go before the "multiply = -1.00" line
	multiply = -1.00
}
#Culture Feeding Determination
feeding_of_a_culture_minority_in_county = {
	this = { save_temporary_scope_as = the_culture }
	value = feeding_of_a_minority_culture_generic
	### Additional, TC-specific features go before the "multiply = -1.00" line
	multiply = -1.00
}
#Faith Support Determination
support_of_a_faith_minority_in_county = {
	this = { save_temporary_scope_as = the_faith }
	value = support_of_a_minority_faith_generic
	### Additional, TC-specific features go before the "multiply = -1.00" line
	### New WtWSMS Features
	scope:the_faith = {
		if = { #Autocephalous faiths are less likely to disappear if their associated cultures are present
			limit = { scope:the_faith = { has_doctrine = tenet_autocephaly } }
			if = {
				limit = {
					OR = {
						scope:the_county.culture = scope:the_faith.var:church_culture
						actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
							ACTOR = scope:the_county
							TARGET_FAITH = scope:the_faith
							VARIABLE = church_culture
						}
					}
				}
				add = majority_province_support_value
			}
			else_if = {
				limit = {
					has_variable_list = culture_minorities_large
					OR = {
						is_target_in_variable_list = {
							name = culture_minorities_large
							target = scope:the_faith.var:church_culture
						}
						any_in_list = {
							variable = culture_minorities_large
							actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
								ACTOR = scope:the_county
								TARGET_FAITH = scope:the_faith
								VARIABLE = church_culture
							}
						}
					}
				}
				add = large_minority_support_value
			}
			else_if = {
				limit = {
					has_variable_list = culture_minorities_small
					OR = {
						is_target_in_variable_list = {
							name = culture_minorities_small
							target = scope:the_faith.var:church_culture
						}
						any_in_list = {
							variable = culture_minorities_small
							actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
								ACTOR = scope:the_county
								TARGET_FAITH = scope:the_faith
								VARIABLE = church_culture
							}
						}
					}
				}
				add = large_minority_support_value
			}
		}
		if = { #Ethnic Religions faiths are less likely to disappear if their associated cultures are present
			limit = { scope:the_faith = { has_doctrine = tenet_ethnic_religion } }
			if = {
				limit = {
					OR = {
						scope:the_county.culture = scope:the_faith.var:ethnic_religion_culture
						actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
							ACTOR = scope:the_county
							TARGET_FAITH = scope:the_faith
							VARIABLE = ethnic_religion_culture
						}
					}
				}
				add = majority_province_support_value
				add = majority_province_support_value
			}
			else_if = {
				limit = {
					has_variable_list = culture_minorities_large
					OR = {
						is_target_in_variable_list = {
							name = culture_minorities_large
							target = scope:the_faith.var:ethnic_religion_culture
						}
						any_in_list = {
							variable = culture_minorities_large
							actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
								ACTOR = scope:the_county
								TARGET_FAITH = this
								VARIABLE = ethnic_religion_culture
							}
						}
					}
				}
				add = large_minority_support_value
				add = large_minority_support_value
			}
			else_if = {
				limit = {
					has_variable_list = culture_minorities_small
					OR = {
						is_target_in_variable_list = {
							name = culture_minorities_small
							target = scope:the_faith.var:ethnic_religion_culture
						}
						any_in_list = {
							variable = culture_minorities_small
							actor_is_faith_culture_or_child_culture_for_cultural_religions_DIRECT_trigger = {
								ACTOR = scope:the_county
								TARGET_FAITH = this
								VARIABLE = ethnic_religion_culture
							}
						}
					}
				}
				add = small_minority_support_value
				add = small_minority_support_value
			}
		}
	}
	multiply = -1.00
}
#Faith Support Determination
feeding_of_a_faith_minority_in_county = {
	this = { save_temporary_scope_as = the_faith }
	value = feeding_of_a_minority_faith_generic
	### Additional, TC-specific features go before the "multiply = -1.00" line
	multiply = -1.00
}
##### Changed from Vanilla ^^^^^
