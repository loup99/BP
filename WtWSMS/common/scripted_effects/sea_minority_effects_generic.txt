### On-Actions
add_minority_to_county_effect = { #county scope
	if = {
		limit = { NOT = { this.$CULTURE_OR_FAITH$ = $ITEM$ } }
		add_to_variable_list = {
			name = $CULTURE_OR_FAITH$_minorities_$SIZE$
			target = $ITEM$
		}
	}
}
displace_majority_with_minority_effect = { #county scope
	add_to_variable_list = {
		name = $CULTURE_OR_FAITH$_minorities_large
		target = this.$CULTURE_OR_FAITH$
	}
	this = { set_county_$CULTURE_OR_FAITH$ = $TARGET$ }
}

#Meant for when the two are linked
add_minority_faith_and_culture_to_county_effect = { #county scope
	add_minority_to_county_effect = {
		CULTURE_OR_FAITH = culture
		ITEM = $CULTURE$
		SIZE = $SIZE$
	}
	add_minority_to_county_effect = {
		CULTURE_OR_FAITH = faith
		ITEM = $FAITH$
		SIZE = $SIZE$
	}
}
add_minority_granular_effect = {
	if = {
		limit = { any_neighboring_county = { count > 1 $CULTURE_OR_FAITH$ = $TARGET$} }
		add_minority_to_county_effect = {
			CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
			ITEM = $TARGET$
			SIZE = large
		}
	}
	else_if = {
		limit = { any_neighboring_county = { count = 1 $CULTURE_OR_FAITH$ = $TARGET$} }
		add_minority_to_county_effect = {
			CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
			ITEM = $TARGET$
			SIZE = small
		}
	}
}
add_minority_granular_universal_effect = {
	if = {
		limit = { any_neighboring_county = { count > 1 $CULTURE_OR_FAITH$ = $TARGET$} }
		add_minority_to_county_effect = {
			CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
			ITEM = $TARGET$
			SIZE = large
		}
	}
	else = {
		add_minority_to_county_effect = {
			CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
			ITEM = $TARGET$
			SIZE = small
		}
	}
}
add_minority_to_region_granular_effect = { #TODO (Immediate): REMOVE?
	every_county = {
		limit = { $REGIONAL_TRIGGER$ = yes }
		if = {
			limit = { any_neighboring_county = { count > 1 $CULTURE_OR_FAITH$ = $TARGET$} }
			add_minority_to_county_effect = {
				CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
				ITEM = $TARGET$
				SIZE = large
			}
		}
		else_if = {
			limit = { any_neighboring_county = { count = 1 $CULTURE_OR_FAITH$ = $TARGET$} }
			add_minority_to_county_effect = {
				CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
				ITEM = $TARGET$
				SIZE = small
			}
		}
	}
}
add_minority_to_region_effect = { #TODO (Immediate): REMOVE?
	every_county = {
		limit = { $REGIONAL_TRIGGER$ = yes }
		if = {
			limit = { any_neighboring_county = { $CULTURE_OR_FAITH$ = $TARGET$} }
			add_minority_to_county_effect = {
				CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
				ITEM = $TARGET$
				SIZE = large
			}
		}
		else = {
			add_minority_to_county_effect = {
				CULTURE_OR_FAITH = $CULTURE_OR_FAITH$
				ITEM = $TARGET$
				SIZE = small
			}
		}
	}
}

### General Routines

remove_specific_minority_modifer_effect = {
	if = {
		limit = { has_county_modifier = minority_$NUMBER$ }
		remove_county_modifier = minority_$NUMBER$
	}
}
add_specific_minority_modifer_effect = { add_county_modifier = minority_$NUMBER$ }
remove_any_minority_modifier_effect = {
	remove_specific_minority_modifer_effect = { NUMBER = 01 }
	remove_specific_minority_modifer_effect = { NUMBER = 02 }
	remove_specific_minority_modifer_effect = { NUMBER = 03 }
	remove_specific_minority_modifer_effect = { NUMBER = 04 }
	remove_specific_minority_modifer_effect = { NUMBER = 05 }
	remove_specific_minority_modifer_effect = { NUMBER = 06 }
	remove_specific_minority_modifer_effect = { NUMBER = 07 }
	remove_specific_minority_modifer_effect = { NUMBER = 08 }
	remove_specific_minority_modifer_effect = { NUMBER = 09 }
	remove_specific_minority_modifer_effect = { NUMBER = 10 }
	remove_specific_minority_modifer_effect = { NUMBER = 11 }
	remove_specific_minority_modifer_effect = { NUMBER = 12 }
	remove_specific_minority_modifer_effect = { NUMBER = 13 }
	remove_specific_minority_modifer_effect = { NUMBER = 14 }
	remove_specific_minority_modifer_effect = { NUMBER = 15 }
	remove_specific_minority_modifer_effect = { NUMBER = 16 }
}
update_minority_modifier_effect = {
	this = { save_temporary_scope_as = the_county }
	#Remove any existing minority modifiers
	remove_any_minority_modifier_effect = yes
	#Add the new modifier
	if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 1 }
		add_specific_minority_modifer_effect = { NUMBER = 01 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 2 }
		add_specific_minority_modifer_effect = { NUMBER = 02 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 3 }
		add_specific_minority_modifer_effect = { NUMBER = 03 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 4 }
		add_specific_minority_modifer_effect = { NUMBER = 04 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 5 }
		add_specific_minority_modifer_effect = { NUMBER = 05 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 6 }
		add_specific_minority_modifer_effect = { NUMBER = 06 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 7 }
		add_specific_minority_modifer_effect = { NUMBER = 07 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 8 }
		add_specific_minority_modifer_effect = { NUMBER = 08 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 9 }
		add_specific_minority_modifer_effect = { NUMBER = 09 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 10 }
		add_specific_minority_modifer_effect = { NUMBER = 10 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 11 }
		add_specific_minority_modifer_effect = { NUMBER = 11 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 12 }
		add_specific_minority_modifer_effect = { NUMBER = 12 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 13 }
		add_specific_minority_modifer_effect = { NUMBER = 13 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 14 }
		add_specific_minority_modifer_effect = { NUMBER = 14 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 15 }
		add_specific_minority_modifer_effect = { NUMBER = 15 }
	}
	else_if = {
		limit = { scope:the_county.number_of_all_minorities_including_size_in_county = 16 }
		add_specific_minority_modifer_effect = { NUMBER = 16 }
	}
	else = { debug_log = "INVALID NUMBER OF MINORITIES IN COUNTY" }
}

#This is done at a county scope
# $ITEM$ = a scoped faith or culture
# $CULTURE_OR_FAITH$: either "culture" or "faith"
promote_minority_but_not_to_majority_effect = {
	if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_small
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
		}
		add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		remove_list_variable = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
	}
	#Large minorities should not become majorities
	else_if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_large
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		}
	}
	else = { add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ } }
	update_minority_modifier_effect = yes
}
# County scope
# $ITEM$ = a scoped faith or culture
# $CULTURE_OR_FAITH$: either "culture" or "faith"
promote_minority_effect = {
	if = {
		limit = { this.$CULTURE_OR_FAITH$ = $ITEM$ }
		#Don't do anything in this case; we're already a majority
	}
	#Small minorities become large minorities
	else_if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_small
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
		}
		add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		remove_list_variable = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
	}
	#Large minorities become majorities
	else_if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_large
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		}
		remove_list_variable = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = this.$CULTURE_OR_FAITH$ }
		set_county_$CULTURE_OR_FAITH$ = $ITEM$
	}
	else = { add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ } }
	update_minority_modifier_effect = yes
}

#This is done at a county scope
# $ITEM$ = a scoped faith or culture
# $CULTURE_OR_FAITH$: either "culture" or "faith"
demote_minority_effect = {
	if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_large
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		}
		remove_list_variable = { name = $CULTURE_OR_FAITH$_minorities_large target = $ITEM$ }
		add_to_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
	}
	else_if = {
		limit = {
			has_variable_list = $CULTURE_OR_FAITH$_minorities_small
			is_target_in_variable_list = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
		}
		remove_list_variable = { name = $CULTURE_OR_FAITH$_minorities_small target = $ITEM$ }
	}
	update_minority_modifier_effect = yes
}

### On-Actions
add_minority_to_county = { #county scope
	if = {
		limit = { NOT = { this.$CULTURE_OR_FAITH$ = $ITEM$ } }
		add_to_variable_list = {
			name = $CULTURE_OR_FAITH$_minorities_$SIZE$
			target = $ITEM$
		}
	}
}

add_minority_faith_and_culture_to_county = { #county scope
	if = {
		limit = { NOT = { this.culture = $CULTURE$ } }
		add_to_variable_list = {
			name = culture_minorities_$CULTURE_SIZE$
			target = $CULTURE$
		}
	}
	if = {
		limit = { NOT = { this.faith = $FAITH$ } }
		add_to_variable_list = {
			name = faith_minorities_$FAITH_SIZE$
			target = $FAITH$
		}
	}
}

### Notification routines
notify_characters_of_minority_reduction_effect = {
	$THE_TARGET_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_TARGET_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	every_in_local_list = {
		list = characters_to_notify
		if = {
			limit = {
				$THE_TARGET_COUNTY$ = { has_variable_list = $CULTURE_OR_FAITH$_minorities_large }
				$THE_TARGET_COUNTY$ = {
					is_target_in_variable_list = {
						name = $CULTURE_OR_FAITH$_minorities_large
						target = scope:item_to_demote
					}
				}
			}
			debug_log = "common/scripted_effects/sea_minority_effects.txt: HAD A CULTURAL/RELIGIOUS MINORITY REDUCTION THAT WAS STILL EXTANT IN LARGE MINORITIES"
		}
		else_if = {
			limit = {
				$THE_TARGET_COUNTY$ = { has_variable_list = $CULTURE_OR_FAITH$_minorities_small }
				$THE_TARGET_COUNTY$ = {
					is_target_in_variable_list = {
						name = $CULTURE_OR_FAITH$_minorities_small
						target = scope:item_to_demote
					}
				}
			}
			send_interface_toast = {
				type = event_generic_neutral
				title = minority_$CULTURE_OR_FAITH$_declined_title
				custom_tooltip = minority_$CULTURE_OR_FAITH$_declined_tt
				right_icon = $THE_TARGET_COUNTY$
			}
		}
		else = {
			send_interface_toast = {
				type = event_generic_neutral
				title = minority_$CULTURE_OR_FAITH$_disappeared_title
				custom_tooltip = minority_$CULTURE_OR_FAITH$_disappeared_tt
				right_icon = $THE_TARGET_COUNTY$
			}
		}
	}
}
notify_characters_of_minority_immigration_effect = {
	$THE_SOURCE_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_SOURCE_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	$THE_TARGET_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_TARGET_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	
	every_in_local_list = {
		list = characters_to_notify
		send_interface_toast = {
			type = event_generic_neutral
			title = $EVENT_TITLE$
			custom_tooltip = $EVENT_TOOLTIP$
			right_icon = $THE_TARGET_COUNTY$
		}
	}
}
notify_characters_of_minority_growth_effect = {
	$THE_SOURCE_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_SOURCE_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	
	every_in_local_list = {
		list = characters_to_notify
		send_interface_toast = {
			type = event_generic_neutral
			title = $EVENT_TITLE$
			custom_tooltip = $EVENT_TOOLTIP$
			right_icon = $THE_SOURCE_COUNTY$
		}
	}
}
notify_characters_of_county_change_immigration_effect = {
	$THE_SOURCE_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_SOURCE_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	$THE_TARGET_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_TARGET_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	
	every_in_local_list = {
		list = characters_to_notify
		trigger_event = { id = minorities.9998 }
	}
}
notify_characters_of_county_change_growth_effect = {
	$THE_SOURCE_COUNTY$.holder = {
		add_to_temporary_list = characters_to_notify
		top_liege = {
			if = { limit = { is_ai = no } add_to_temporary_list = characters_to_notify }
			every_vassal_or_below = {
				limit = {
					is_ai = no
					any_sub_realm_county = { this = $THE_SOURCE_COUNTY$ }
				}
				add_to_temporary_list = characters_to_notify
			}
		}
	}
	
	every_in_local_list = {
		list = characters_to_notify
		trigger_event = { id = minorities.9999 }
	}
}