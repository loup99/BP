##### Changed from Vanilla: Blocked before innovation_leges_barbarorum & 
confederation_kingdom_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/mpo_decision_confederation.dds"
	}
	decision_group_type = major
	ai_check_interval = 12
	desc = confederation_kingdom_decision_desc

	is_shown = {
		is_confederation_member = yes
		is_landed = yes
		is_playable_character = yes
	}

	is_valid = {
		prestige_level >= 3
		is_independent_ruler = yes
		custom_description = {
			text = confederation_kingdom_decision_vassal_req
			confederation = {
				any_confederation_member = {
					highest_held_title_tier >= tier_county
					count >= 5
				}
			}
		}
		custom_tooltip = {
			text = confederation_kingdom_decision_vassal_opinion_req
			NOT = {
				confederation = {
					any_confederation_member = {
						this != root
						opinion = {
							target = root
							value < 25
						}
					}
				}
			}
		}
		custom_tooltip = {
			text = confederation_kingdom_decision_vassal_prestige_level_req
			NOT = {
				confederation = {
					any_confederation_member = {
						this != root
						prestige_level >= root.prestige_level
					}
				}
			}
		}
		##### Changed from Vanilla vvvvv
		culture = { has_innovation = innovation_leges_barbarorum }
		culture = { has_innovation = innovation_social_stratification }
		##### Changed from Vanilla ^^^^^
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		is_at_war = no
		is_tributary = no
		custom_tooltip = {
			text = confederation_kingdom_decision_vassal_wars_req
			NOT = {
				confederation = {
					any_confederation_member = {
						is_at_war = yes
					}
				}
			}
		}
	}

	cost = {
		prestige = {
			value = {
				add = 0
				if = {
					limit = {
						government_has_flag = government_is_tribal
					}
					add = medium_prestige_value
				}
			}
		}
		herd = {
			value = {
				add = 0
				if = {
					limit = {
						government_has_flag = government_is_nomadic
					}
					add = medium_herd_value_static
				}
			}
		}
	}

	effect = {
		custom_tooltip = confederation_kingdom_creation_tt
		custom_tooltip = confederation_succession_tt
		custom_tooltip = confederation_king_modifier_tt
		custom_tooltip = confederation_vassal_modifier_tt
		custom_tooltip = confederation_county_modifier_tt
		save_scope_as = new_king_ruler
		hidden_effect = {
			confederation = {
				every_confederation_member = {
					add_to_list = confederation_vassals
					every_tributary = {
						limit = {
							highest_held_title_tier <= tier_duchy
						}
						add_to_list = confederation_vassals
					}
				}
			}
			primary_title = {
				save_scope_as = old_title
			}
			save_scope_as = confederation_offerer
			create_dynamic_title = {
				tier = kingdom
				name = CONFEDERATION_CULTURE_NAME
				adj = CONFEDERATION_CULTURE_NAME_ADJ
				pre = article_CONFEDERATION_CULTURE_NAME
			}
			scope:new_title = {
				set_variable = {
					name = confederation_culture
					value = scope:confederation_offerer.culture
				}
			}
			scope:new_title = {
				set_color_from_title = root.capital_county
				set_definitive_form = yes
			}
			
			create_title_and_vassal_change = {
				type = created
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:new_title = {
				set_destroy_on_gain_same_tier = yes
				set_no_automatic_claims = yes
				set_can_be_named_after_dynasty = no
				set_can_use_nomadic_naming = no
				change_title_holder = {
					holder = root
					change = scope:change
				}
			}
			every_in_list = {
				list = confederation_vassals
				change_liege = {
					liege = root
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
			
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
				add_claim_on_loss = no
			}
			every_in_list = {
				list = confederation_vassals
				limit = {
					NOT = {
						this = root
					}
				}
				if = {
					limit = {
						has_government = herder_government
					}
					every_held_title = {
						limit = {
							tier = tier_county
							title_province = {
								has_holding_type = herder_holding
							}
						}
						title_province = {
							set_holding_type = nomad_holding
						}
					}
					change_government = nomad_government
				}
				change_liege = {
					liege = root
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
			

			scope:new_title = {
				generate_coa = yes
				add_title_law = confederation_elective_succession_law
				set_capital_county = root.capital_county
			}
			set_primary_title_to = scope:new_title
			confederation = {
				disband_confederation = yes
			}
			every_in_list = {
				list = confederation_vassals
				limit = {
					this != root
				}
				trigger_event = mpo_decisions_events.0004
			}
			trigger_event = mpo_decisions_events.0005
		}
	}

	ai_potential = {
		is_confederation_member = yes
	}

	ai_will_do = {
		base = 100
	}
}