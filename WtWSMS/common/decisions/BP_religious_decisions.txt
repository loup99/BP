### Christian Decisions
peregrinition_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
	}
	decision_group_type = major

	desc = peregrinition_decision_desc
	selection_tooltip = peregrinition_decision_tooltip

	is_shown = {
		faith = { has_doctrine_parameter = peregrinition_active }
	}

	is_valid = {
		has_trait = zealous
		NOT = { has_trait = ambitious }
		#You can't leave without your heir being of age
		trigger_if = {
			limit = { is_ruler = yes }
			custom_description = {
				text = text_is_a_ruler_and_has_a_valid_player_heir
				exists = player_heir
				player_heir = { age >= 16 }
			}
		}
	}

	effect = {
		save_scope_as = actor
		hidden_effect = { add_piety_level = 1 }
		show_as_tooltip = { add_piety_level = 1 }
		add_trait = devoted
		if = {
			limit = { is_ruler = yes }
			depose = yes
		}
		#Remove spouses and spouse adjacent
		if = {
			limit = { is_married = yes }
			every_spouse = { divorce = scope:actor }
		}
		if = {
			limit = { exists = betrothed }
			break_betrothal = betrothed
		}
		if = {
			limit = { is_concubine = yes }
			this.concubinist = { remove_concubine = scope:actor }
		}
		if = {
			limit = { number_of_concubines > 0 }
			every_concubine = { scope:actor = { remove_concubine = prev } }
		}
		#Remove wards
		if = {
			limit = { any_courtier = { has_relation_ward = scope:actor } }
			every_courtier = {
				limit = { has_relation_ward = scope:actor }
				remove_relation_ward = scope:actor
				return_to_court = yes
			}
		}
		#Remove all claims
		every_claim = {
			scope:actor = { remove_claim = prev }
		}
		#Go into the wilderness
		select_and_move_to_pool_effect = yes
	}

	ai_check_interval = 60
	
	ai_potential = {
		exists = primary_heir
		primary_heir = { dynasty = root.dynasty }
		is_at_war = no
	}

	#Cribbed from Consolateum
	ai_will_do = {
		base = 0

		# 100% chance at 50 zeal
		ai_value_modifier = {
			ai_zeal = 2
		}

		modifier = {
			add = 40
			is_close_family_of = primary_heir
		}
	}
}

raise_circumcellions_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
	}
	decision_group_type = major

	desc = raise_circumcellions_decision_desc
	selection_tooltip = raise_circumcellions_decision_tooltip
	
	is_shown = {
		root.faith = { has_doctrine_parameter = raise_circumcellions_decision }
		is_ruler = yes
		NOT = { government_has_flag = government_is_nomadic }
		trigger_if = { #Available for high tribals, but not tribals
			limit = { government_has_flag = government_is_tribal }
			government_has_flag = government_is_settled
		}
	}
	
	is_valid = {
		custom_description = {
			text = recently_called_circumcellions
			NOT = { has_character_flag = recently_called_circumcellions }
		}
		piety_level >= 1
		is_at_war = yes
		#Must be at war with an infidel as the primary
		custom_description = { #Change to faith hostility level must be Evil
			text = must_be_fighting_infidel_as_primary_opponent
			any_character_war = {
				is_war_leader = root
				save_temporary_scope_as = the_war_in_question
				root = {
					any_war_enemy = {
						scope:the_war_in_question = { is_war_leader = root }
						save_temporary_scope_as = the_other_leader
						root.faith = { faith_hostility_level = { target = scope:the_other_leader.faith value > faith_astray_level } }
					}
				}
			}
		}
		NOT = { has_trait = excommunicated } #Definitely not allowed in this case; can't fight the Bishop of Carthage deposing you
	}
	
	is_valid_showing_failures_only = {
		completely_controls = root.capital_county
		piety >= 0
		is_imprisoned = no
		is_available_adult = yes
	}
	
	cost = { piety = root.circumellion_piety_cost }
	
	effect = {
		root = {
			save_temporary_scope_as = the_ruler
			ordered_character_war = {
				order_by = given_war_other_side_max_military_strength
				position = 0
				save_scope_as = chosen_war
			}
		}
		every_realm_county = {
			limit = {
				this.holder = root
				this.faith = root.faith
			}
			root = {
				spawn_army = {
					levies = 300
					men_at_arms = {
						type = light_footmen
						stacks = 2
					}
					location = scope:the_ruler.capital_province
					uses_supply = no
					war = scope:chosen_war
					inheritable = no
					name = circumcellions_army_name
				}
			}
			#The peasants are ~~revolting~~ fighting for us, sir.
			change_county_control = -25
			#And the impact sticks around for years
			add_county_modifier = { modifier = county_raised_circumcellions years = 5 }
		}
		hidden_effect = {
			root = { add_character_flag = { flag = recently_called_circumcellions years = 5 } }
			root = { save_temporary_scope_as = circumellions_raiser }
			every_character_war = {
				every_war_participant = {
					#limit = { NOT = { this = root } }
					send_interface_message = {
						type = event_generic_neutral
						title = circumellions_raised_title
						desc = circumellions_raised_desc
						tooltip = circumellions_raised_tt
						left_icon = root
					}
				}
			}
		}
	}
	
	ai_check_interval = 60
	
	ai_potential = { is_at_war = yes }
	
	ai_will_do = {
		base = 50 # 50% Chance in general (we want it to be likely to happen if conditions are right)
		#Zealous and Ambitious required, also needs enough piety
		
		#Won't do if they can't pay
		modifier = {
			factor = 0
			NOT = { piety >= root.circumellion_piety_cost }
		}
		#Won't do if cynical
		modifier = {
			factor = 0
			has_trait = cynical
		}
		#Won't do if they aren't significantly outgunned
		modifier = {
			factor = 0
			root.my_side_max_military_strength > root.three_fourths_other_sides_max_military_strength
		}
		#Arrogant halves the chance (Having the peasants help us?!)
		modifier = {
			factor = 0.5
			has_trait = arrogant
		}
		#Likely to do if Zealous/Ambitious (it'll keep them in the Empire and all that)
		#Will do if both zealous and ambitious, even if arrogant
		modifier = {
			factor = 1.59 #sqrt(2.5) rounded up
			has_trait = zealous
		}
		modifier = {
			factor = 1.59 #sqrt(2.5) rounded up
			has_trait = ambitious
		}
	}
}

### Pagan Decisions
automutiliation_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
	}
	decision_group_type = major

	desc = automutiliation_decision_desc
	selection_tooltip = automutiliation_decision_tooltip

	is_shown = {
		faith = { has_doctrine = special_doctrine_sacred_eunuchs }
	}

	is_valid = {
		NOT = { has_trait = eunuch_1 }
		has_trait = zealous
		#You can't hurt yourself without at least an heir
		trigger_if = {
			limit = { is_ruler = yes }
			custom_description = {
				text = text_is_a_ruler_and_has_a_player_heir
				exists = player_heir
			}
		}
	}

	effect = {
		save_scope_as = actor
		hidden_effect = { add_piety_level = 1 }
		show_as_tooltip = { add_piety_level = 1 }
		add_trait = devoted
		add_trait = eunuch_1
		
		#Remove spouses and spouse adjacent
		if = {
			limit = { is_married = yes }
			every_spouse = { divorce = scope:actor }
		}
		if = {
			limit = { exists = betrothed }
			break_betrothal = betrothed
		}
		if = {
			limit = { is_concubine = yes }
			this.concubinist = { remove_concubine = scope:actor }
		}
		if = {
			limit = { number_of_concubines > 0 }
			every_concubine = { scope:actor = { remove_concubine = prev } }
		}
		show_as_tooltip = {
			random_list = {
				90 = {}
				4 = { add_trait = ill }
				3 = { add_trait = wounded_1 }
				2 = { add_trait = wounded_2 }
				1 = { add_trait = wounded_3 }
			}
		}
	}
	
	ai_check_interval = 60
	
	ai_potential = {
		exists = primary_heir
		primary_heir = { dynasty = root.dynasty }
		is_at_war = no
	}

	#Cribbed from Consolateum
	ai_will_do = {
		base = 0

		# 100% chance at 50 zeal
		ai_value_modifier = {
			ai_zeal = 2
		}

		modifier = {
			add = 40
			is_close_family_of = primary_heir
		}
	}
}

### Hindu Decisions

#Philosophies
# Orthodox Schools: Samkhya, Yoga, Vedanta, Vaiśeṣika, Nyaya, Mīmāṃsā
# Hetrodox Schools: Sramana, Carvaka, Ajivika

select_hindu_philosophy_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_personal_religious.dds"
	}

	desc = select_hindu_philosophy_decision_desc
	selection_tooltip = select_hindu_philosophy_decision_tooltip

	is_shown = {
		religion = religion:hinduism_religion
		is_adult = yes
	}

	is_valid = {
		has_trait = scholar
	}

	is_valid_showing_failures_only = {
		# Have to at _least_ not be in piety debt.
		piety >= 0
		is_imprisoned = no
	}

	cooldown = { years = 2 }

	#Link triggers to BP_hindu_decisions.txt
	effect = {
		show_as_tooltip = {
			random_list = {
				desc = select_hindu_philosophy_decision_tt
				100 = {
					trigger = { NOT = { has_trait = cynical } }
					show_chance = no
					desc = select_hindu_philosophy_decision.yoga
					add_trait = hindu_philosophy_yoga
				}
				100 = {
					show_chance = no
					desc = select_hindu_philosophy_decision.samkhya
					add_trait = hindu_philosophy_samkhya
				}
				100 = {
					show_chance = no
					desc = select_hindu_philosophy_decision.vaisheshika
					add_trait = hindu_philosophy_vaisheshika
				}
				100 = {
					show_chance = no
					desc = select_hindu_philosophy_decision.mimamsa
					add_trait = hindu_philosophy_mimamsa
				}
				100 = {
					show_chance = no
					desc = select_hindu_philosophy_decision.nyaya
					add_trait = hindu_philosophy_nyaya
				}
				100 = {
					show_chance = no
					desc = select_hindu_philosophy_decision.vedanta
					add_trait = hindu_philosophy_vedanta
				}
				100 = {
					trigger = { NOT = { has_trait = zealous } }
					show_chance = no
					desc = select_hindu_philosophy_decision.charvaka
					add_trait = hindu_philosophy_charvaka
				}
				100 = {
					trigger = { NOT = { has_trait = zealous } }
					show_chance = no
					desc = select_hindu_philosophy_decision.ajivika
					add_trait = hindu_philosophy_ajivika
				}
			}
		}
		trigger_event = hindu_decision.0101
	}

	ai_check_interval = 96
	
	ai_potential = {
		piety >= minor_piety_value
		NOR = {
			has_trait = hindu_philosophy_samkhya
			has_trait = hindu_philosophy_yoga
			has_trait = hindu_philosophy_nyaya
			has_trait = hindu_philosophy_vaisheshika
			has_trait = hindu_philosophy_mimamsa
			has_trait = hindu_philosophy_vedanta
			has_trait = hindu_philosophy_charvaka
			has_trait = hindu_philosophy_ajivika
		}
	}

	ai_will_do = {
		base = 100
	}
}
