##### These are all religious decisions relating to changing Doctrines and Tenets of a faith

########## CHRISTIAN DECISIONS ##########

#Converting a Rite to an independent Church
establish_autocephalous_church_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/cathedral_soa_day.dds"
	}
	decision_group_type = BP_religious_decisions_major

	desc = establish_autocephalous_church_decision_desc
	selection_tooltip = establish_autocephalous_church_decision_tooltip
	
	is_shown = {
		faith = {
			has_doctrine = tenet_rite
			religion = religion:christianity_religion
		}
		faith.religious_head.faith = { has_doctrine_parameter = enables_formation_of_autocephalous_churches }
	}
	
	is_valid = {
		highest_held_title_tier >= tier_kingdom
		
		custom_description = {
			text = the_culture_does_not_have_an_autocephalous_church
			NOT = {
				#Go through all Christian faiths. If root.culture is a Faith Culture or a Faith Child
				#Culture, note that it exists
				religion:christianity_religion = {
					any_faith = {
						exists = this.var:church_culture
						trigger_if = {
							limit = { exists = this.var:church_culture }
							this.var:church_culture = { save_temporary_scope_as = the_culture }
							OR = {
								root.culture = scope:the_culture
								AND = {
									root.culture = { any_parent_culture_or_above = { this = scope:the_culture } }
									root.culture = { has_same_culture_heritage = scope:the_culture }
								}
							}
						}
					}
				}
			}
		}
		
		#Must have 75% of the realm following your rite
		custom_description = {
			text = at_least_three_fourths_of_realm_follows_faith
			any_sub_realm_county = {
				percent >= 0.75
				faith = root.faith
			}
		}
		#Must control 75% of the rites' counties
		custom_description = {
			text = controls_least_three_fourths_of_counties_follows_faith
			check_if_control_percentage_of_all_counties_with_condition_trigger = {
				FEATURE = faith
				CHARACTER = root
				PERCENTAGE = 0.75
			}
		}
		#Must control 75% of your culture's counties
		AND = {
			custom_description = {
				text = controls_least_three_fourths_of_counties_with_culture
				check_if_control_percentage_of_all_counties_with_condition_trigger = {
					FEATURE = culture
					CHARACTER = root
					PERCENTAGE = 0.75
				}
			}
		}
		#Need to have enough pull with the HOF to get him to approve it if you aren't an independent king
		trigger_if = {
			limit = { is_independent_ruler = no }
			OR = {
				custom_description = { #3 Holy Sites, he can't politically defend granting you autocephaly
					text = controls_three_holy_sites
					root = { any_sub_realm_county = { count >= 3 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
				}
				AND = { #2 Holy Sites, and at least some weak pull
					custom_description = {
						text = controls_two_holy_sites
						root = { any_sub_realm_county = { count >= 2 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
					}
					has_hook = faith.religious_head
				}
				AND = {
					custom_description = { #1 Holy Sites, but you have some strong pull on him
						text = controls_one_holy_site
						root = { any_sub_realm_county = { count >= 1 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
					}
					has_strong_hook = faith.religious_head
				}
			}
		}
		custom_description = {
			text = hof_is_not_a_vassal
			NOT = { root = { is_liege_or_above_of = faith.religious_head } }
		}
	}
	
	is_valid_showing_failures_only = {
		piety >= 0
		is_imprisoned = no
	}
	
	effect = {
		faith = {
			remove_doctrine = tenet_rite
			add_doctrine = tenet_autocephaly
		}
		if = { #Need conditional to prevent some weirdness in localization
			limit = { has_hook = faith.religious_head }
			remove_hook = { target = faith.religious_head }
		}
		faith.religious_head = { save_scope_as = old_hof } #Done here because we're about to change religious heads
		root = { bp_set_up_dynamic_spiritual_hof_title_effect = { CREATOR = root } }
		custom_description = {
			text = new_hof_becomes_your_vassal
			subject = root.faith
			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
			}
			faith.religious_head = {
				change_liege = {
					liege = root
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
		custom_description = {
			text = rite_is_associated_with_your_culture
			#Set the Autocephalous Church flag
			faith = { set_variable = { name = church_culture value = root.culture } }
		}
		#Apply appropriate laws
		hidden_effect = {
			faith.religious_head = {
				add_realm_law_skip_effects = same_faith_theocratic_succession_law
				add_realm_law_skip_effects = bishop_theocratic_succession_law
			}
			#Prevent ruler from creating another faith while he lives
			root = { set_variable = { name = has_created_a_faith } }
		}
		#Cribbed these scopes from faith_creation.1000 (which we borrow text from liberally)
		root = { save_scope_as = reformer }
		root.faith = { save_scope_as = reformed_faith }
		root.faith.religious_head = { save_scope_as = reformed_hof }
		#Inform players of a new Christian Church
		every_ruler = { trigger_event = { id = BP_religious_decisions_major.0001 } }
	}
	
	ai_check_interval = 60
	
	ai_potential = {
		is_at_war = no
	}
	
	ai_will_do = {
		base = 100 #100% chance (why wouldn't they, zealous or not?)
		
		modifier = { #AI Ethiopian Orthodox Chars will never pursue autocephaly, as per history
			factor = 0
			faith = faith:ethiopian_orthodox
		}
	}
}

########## ZOROASTRIAN DECISIONS ##########

#Legalize Caucasian Christianity
legalize_caucasian_christianity = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/the_return_to_the_homeland.dds"
	}
	decision_group_type = BP_religious_decisions_major

	desc = legalize_caucasian_christianity_desc
	selection_tooltip = legalize_caucasian_christianity_tooltip
	
	is_shown = {
		has_title = title:e_persia
		has_religion = religion:zoroastrianism_religion
		NOT = { has_global_variable = persia_legalizes_caucasian_christianity }
		NAND = {
			faith:armenian_apostolic = { has_doctrine = special_doctrine_legalized_faith_persia }
			faith:georgian_orthodox = { has_doctrine = special_doctrine_legalized_faith_persia }
			faith:albanian_apostolic = { has_doctrine = special_doctrine_legalized_faith_persia }
		}
	}
	
	is_valid = {
		NOR = {
			has_realm_law = clerical_influence_2
			has_realm_law = clerical_influence_3
		}
		prestige_level >= 2
		piety_level >= 1
	}
	
	is_valid_showing_failures_only = {
		piety >= 0
		is_imprisoned = no
		is_available_adult = yes
		is_at_war = no
	}
	
	cost = {
		piety = 250
		gold = tiny_gold_max_value
	}
	
	effect = {
		show_as_tooltip = { caucasian_christian_legalization_local_effect = yes }
		hidden_effect = {
			root = { save_scope_as = legalizing_emperor }
			trigger_event = { id = BP_religious_decisions_major.0101 }
		}
	}
	
	ai_check_interval = 60
	
	ai_potential = {
		is_at_war = no
	}
	
		ai_will_do = {
		base = 80 # 80% Chance in general (we want it to be likely to happen if conditions are right)
		#Zealous and Ambitious required, also needs enough gold
		
		#Won't do if they can't pay
		modifier = {
			factor = 0
			NOT = { gold >= tiny_gold_max_value }
			NOT = { piety >= 250 }
		}
		#Won't do if zealous
		modifier = {
			factor = 0
			has_trait = zealous
		}
		#Arrogant halves the chance (Who do they think they are?!)
		modifier = {
			factor = 0.5
			has_trait = arrogant
		}
		#Likely to do if Cynical/Ambitious (it'll keep them in the Empire and all that)
		#Will do if both cynical and ambitious, even if arrogant
		modifier = {
			factor = 1.59 #sqrt(2.5) rounded up
			has_trait = cynical
		}
		modifier = {
			factor = 1.59 #sqrt(2.5) rounded up
			has_trait = ambitious
		}
	}
}

########## GERMANIC DECISIONS ##########
adopt_human_sacrifice_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_major_religion.dds"
	}
	decision_group_type = BP_religious_decisions_major

	desc = adopt_human_sacrifice_decision_desc
	selection_tooltip = adopt_human_sacrifice_decision_tooltip

	is_shown = {
		is_ai = no
		is_independent_ruler = yes
		is_landed = yes
		this.religion = religion:germanic_religion
		this.faith = { has_doctrine_parameter = unreformed }
		NOR = {
			this.faith = { has_doctrine = tenet_human_sacrifice }
			this.faith = { has_doctrine = tenet_gruesome_festivals }
		}
	}

	is_valid = {
		#Have a holy site in your realm
		custom_description = { #1 Holy Sites, but you have some strong pull on him
			text = controls_one_holy_site
			root = { any_sub_realm_county = { count >= 1 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
		}
		
		#Have at two of your holy sites controlled by your faith
		custom_description = {
			text = at_least_two_holy_sites_controlled_by_your_faith
			this.faith = {
				any_holy_site = {
					count >= 2
					this.holder.top_liege.faith = root.faith
				}
			}
		}
		
		#Be noticeably pious
		piety_level >= 3
	}
	
	cost = {
		piety = 1000
		prestige = 500
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		is_available_adult = yes
	}

	effect = {
		#Replaces human sacrifice with Blot and raises piety level if possible
		root = { save_scope_as = human_sacrifice_reformer }
		show_as_tooltip = { establish_human_sacrifice_effect = yes }
		hidden_effect = { trigger_event = { id = BP_religious_decisions_major.0202 } }
	}
	
	ai_check_interval = 60
	
	ai_potential = { always = no }

	#AI has to be at least somewhat bold/vengeful/zealous to try
	ai_will_do = {
		base = 0
	}
}

adopt_the_blot_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_major_religion.dds"
	}
	decision_group_type = BP_religious_decisions_major

	desc = adopt_the_blot_decision_desc
	selection_tooltip = adopt_the_blot_decision_tooltip

	is_shown = {
		is_independent_ruler = yes
		is_landed = yes
		this.religion = religion:germanic_religion
		this.faith = { has_doctrine_parameter = unreformed }
		this.faith = { has_doctrine = tenet_human_sacrifice }
	}

	is_valid = {
		trigger_if = { #Triggered for localization reasons
			limit = { root.faith = { has_variable = human_sacrifice_added } }
			custom_description = {
				text = have_not_recently_adopted_human_sacrifice
				NOT = { root.faith = { has_variable = human_sacrifice_added } }
			}
		}
		
		#Culture must be somewhat centralized
		OR = {
			culture = { has_innovation = innovation_leges_barbarorum }
			culture = { has_innovation = innovation_social_stratification }
		}
		
		#Have a holy site in your realm
		custom_description = { #1 Holy Sites, but you have some strong pull on him
			text = controls_one_holy_site
			root = { any_sub_realm_county = { count >= 1 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
		}
		
		#Have at least of your holy sites controlled by your faith
		custom_description = {
			text = at_least_three_holy_sites_controlled_by_your_faith
			this.faith = {
				any_holy_site = {
					count >= 3
					this.holder.top_liege.faith = root.faith
				}
			}
		}
		
		#Must control 25% of the faith's counties
		custom_description = {
			text = controls_least_twenty_five_percent_of_counties_follows_faith
			check_if_control_percentage_of_all_counties_with_condition_trigger = {
				FEATURE = faith
				CHARACTER = root
				PERCENTAGE = 0.25
			}
		}
		
		#Be noticeably pious
		piety_level >= 3
	}
	
	cost = {
		piety = 500
		prestige = 250
		gold = 50
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		is_available_adult = yes
	}

	effect = {
		#Replaces human sacrifice with Blot and raises piety level if possible
		root = { save_scope_as = blot_reformer }
		show_as_tooltip = { create_the_blot_effect = yes }
		hidden_effect = { trigger_event = { id = BP_religious_decisions_major.0201 } }
	}
	
	ai_check_interval = 60
	
	ai_potential = {
		is_at_war = no
		is_landed = yes
		is_ruler = yes
		AND = { #AI won't do this until sufficiently advanced
			culture = { has_innovation = innovation_leges_barbarorum }
			culture = { has_innovation = innovation_social_stratification }
		}
	}

	#AI has to be at least somewhat bold/vengeful/zealous to try
	ai_will_do = {
		base = 0

		#Personality effects
		modifier = { add = ai_energy }
		modifier = { add = ai_boldness }
		modifier = { add = ai_vengefulness }
		modifier = { add = ai_zeal }
		modifier = {
			add = {
				value = ai_compassion
				multiply = -1
			}
		}

		modifier = { #Cynics are unlikely
			factor = 0.5
			has_trait = cynical
		}
		modifier = { #Zealous makes things more likely
			factor = 2
			has_trait = zealous
		}
		#Being bloody will make it more likely
		modifier = {
			factor = 1.414
			has_trait = callous
		}
		modifier = {
			factor = 1.414
			has_trait = sadistic
		}
		modifier = {
			factor = 1.414
			has_trait = paranoid
		}
		modifier = {
			factor = 1.414
			has_trait = vengeful
		}
		modifier = {
			factor = 1.414
			has_trait = wrathful
		}
		#Being the forgiving sort will make it impossible
		modifier = {
			factor = 0
			OR = {
				has_trait = forgiving
				has_trait = compassionate
			}
		}
	}
}

adopt_warmongering_decision = {
	picture = {
		reference = "gfx/interface/illustrations/decisions/decision_major_religion.dds"
	}
	decision_group_type = BP_religious_decisions_major

	desc = adopt_warmongering_decision_desc
	selection_tooltip = adopt_warmongering_decision_tooltip

	is_shown = {
		is_ai = no
		is_independent_ruler = yes
		is_landed = yes
		this.religion = religion:germanic_religion
		this.faith = { has_doctrine_parameter = unreformed }
		NOT = { this.faith = { has_doctrine = tenet_warmonger } }
	}

	is_valid = {
		#Have a holy site in your realm
		custom_description = { #1 Holy Sites, but you have some strong pull on him
			text = controls_one_holy_site
			root = { any_sub_realm_county = { count >= 1 any_county_province = { barony = { is_holy_site_of = root.faith } } } }
		}
		
		#Have at two of your holy sites controlled by your faith
		custom_description = {
			text = at_least_two_holy_sites_controlled_by_your_faith
			this.faith = {
				any_holy_site = {
					count >= 2
					this.holder.top_liege.faith = root.faith
				}
			}
		}
		
		#Be noticeably pious
		piety_level >= 3
	}
	
	cost = {
		piety = 500
		prestige = 500
	}

	is_valid_showing_failures_only = {
		is_at_war = no
		is_available_adult = yes
	}

	effect = {
		#Replaces human sacrifice with Blot and raises piety level if possible
		root = { save_scope_as = warmonger_reformer }
		show_as_tooltip = { establish_warmonger_effect = yes }
		hidden_effect = { trigger_event = { id = BP_religious_decisions_major.0202 } }
	}
	
	ai_check_interval = 60
	
	ai_potential = { always = no }

	#AI has to be at least somewhat bold/vengeful/zealous to try
	ai_will_do = {
		base = 0
	}
}