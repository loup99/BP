namespace = bp_historical_flavor

#bp_historical_flavor.0001 - Vandals get a bunch of Roman Slaves
#bp_historical_flavor.0002 - Fall of Rome to Barbarians

# Roman vandal prisoners, Genseric took countless Romans back to Carthage as slaves during his sack of Rome
bp_historical_flavor.0001 = { #WTWSMS id: zusk_event.50
	type = character_event
	title = bp_historical_flavor.0001.name
	desc = bp_historical_flavor.0001.desc
	
	theme = dungeon
	
	immediate = {
		create_character = {
			location = scope:geneseric.location
			name = "Gaudentius"
			random_traits = no
			age = 36
			gender  = male
			faith = faith:hellenic_pagan
			culture = culture:roman
			dynasty = none
			trait = "zealous"
			trait = "ambitious"
			trait = "diligent"
			save_scope_as = gaudentius
			after_creation = { add_to_list = slave_list }
		}
		
		#Ratio of ages in zusk_event.50 list: 5 kids, 11 under 40, 4 over 40
		#Age: Was as high as 60, in zusk_event.50, but uniform distribution can yield strong biases in
		#one side or the other, so break up into 16-40, and 40-60
		
		#Design note: can't pass something like {6 15} as an argument for $STUFF$ syntax, so duplicating
		#code here is mostly unavoidable
		
		#Child characters
		set_while_counter_variable_effect = yes
		while = {
			limit = { var:while_counter < 5 }
			create_character = {
				location = scope:geneseric.location
				template = bp_random_roman_slave_child
				dynasty = none
				#Ratio of zusk_event.50 list:
				#	16 Nicene : 3 Manichean : 1 Hellenic Pagan
				#so revisited values:
				#	16 Nicene : 3 Hellenic Pagan : 1 Manichean
				random_faith = {
					faith:nicene = { weight = 16 }
					faith:hellenic_pagan = { weight = 3 }
					faith:manichean = { weight = 1 }
				}
				after_creation = { add_to_list = slave_list }
			}
			increase_while_counter_variable_effect = yes
		}
		remove_while_counter_variable_effect = yes
		#Adults
		set_while_counter_variable_effect = yes
		while = {
			limit = { var:while_counter < 11 }
			create_character = {
				location = scope:geneseric.location
				age = { 16 40 }
				template = bp_random_roman_slave_adult_no_age
				dynasty = none
				#Ratio of zusk_event.50 list: 5 kids, 11 under 40, 4 over 40
				#Ratio of zusk_event.50 list:
				#	16 Nicene : 3 Manichean : 1 Hellenic Pagan
				#so revisited values
				random_faith = {
					faith:nicene = { weight = 16 }
					faith:hellenic_pagan = { weight = 3 }
					faith:manichean = { weight = 1 }
				}
				after_creation = { add_to_list = slave_list }
			}
			increase_while_counter_variable_effect = yes
		}
		remove_while_counter_variable_effect = yes
		#Middle Aged
		set_while_counter_variable_effect = yes
		while = {
			limit = { var:while_counter < 4 }
			create_character = {
				location = scope:geneseric.location
				age = { 16 40 }
				template = bp_random_roman_slave_adult_no_age
				dynasty = none
				#Ratio of zusk_event.50 list: 5 kids, 11 under 40, 4 over 40
				#Ratio of zusk_event.50 list:
				#	16 Nicene : 3 Manichean : 1 Hellenic Pagan
				#so revisited values
				random_faith = {
					faith:nicene = { weight = 16 }
					faith:hellenic_pagan = { weight = 3 }
					faith:manichean = { weight = 1 }
				}
				after_creation = { add_to_list = slave_list }
			}
			increase_while_counter_variable_effect = yes
		}
		remove_while_counter_variable_effect = yes
	}
	
	left_portrait = {
		character = scope:gaudentius
		animation = sadness
	}
	right_portrait = {
		character = scope:geneseric
		animation = personality_callous
	}
	
	option = {
		name = bp_historical_flavor.0001.a
		every_in_list = {
			list = slave_list
			save_scope_as = the_slave
			scope:geneseric = { imprison = { target = scope:the_slave type = dungeon } }
		}
	}
}

bp_historical_flavor.0002 = { #WTWSMS id: zusk_event.30
	title = bp_historical_flavor.0002.name
	desc = bp_historical_flavor.0002.desc
	type = character_event
	theme = battle
	override_background = { event_background = burning_building }
	
	immediate = {
		#Prevent from firing twice
		title:c_roma.holder = { save_scope_as = barbarian_ruler }
		set_global_variable = {
			name = fall_of_rome
			value = scope:barbarian_ruler
		}
	}
	
	right_portrait = {
		character = scope:barbarian_ruler
		animation = war_over_win
	}
	
	option = { #General Response
		name = bp_historical_flavor.0002.general_response
		trigger = {
			NOT = { has_title = title:e_byzantium }
			NOT = { religion = religion:germanic_religion }
			NOT = { faith = faith:nicene }
			NOT = { this = character:55 }
			NOT = { this = character:93 }
			NOT = { this = character:175110 }
		}
	}
	option = { #Germanic Pagans
		name = bp_historical_flavor.0002.germanic_religion_response
		trigger = {
			NOT = { has_title = title:e_byzantium }
			NOT = { faith = faith:nicene }
			NOT = { this = character:55 }
			NOT = { this = character:93 }
			NOT = { this = character:175110 }
			religion = religion:germanic_religion
		}
		add_piety = 100
	}
	option = { #Christians harmonized with the Imperial church
		name = bp_historical_flavor.0002.imperial_christian_response
		trigger = {
			NOT = { has_title = title:e_byzantium }
			NOT = { faith = faith:nicene }
			NOT = { this = character:55 }
			NOT = { this = character:93 }
			NOT = { this = character:175110 }
			AND = {
				religion = religion:christianity_religion
				this.faith = { considers_astray_trigger = { FAITH = faith:nicene } }
			}
		}
		add_piety = -100
	}
	option = { #Odoacer
		name = bp_historical_flavor.0002.odoacer_response
		trigger = { this = character:55 }
		add_piety = 1000
		add_prestige = 1000
	}
	option = { #Genseric
		name = bp_historical_flavor.0002.genseric_response
		trigger = { this = character:93 }
	}
	option = { #Julius Nepos
		name = bp_historical_flavor.0002.nepos_response
		trigger = { this = character:175110 }
		#Add triggered event to transfer e_wre
	}
	option = { #Byzantine Option
		name = bp_historical_flavor.0002.byzantine_response
		trigger = {
			has_title = title:e_byzantium
			NOT = { this = character:55 }
			NOT = { this = character:93 }
			NOT = { this = character:175110 }
		}
		#Drop everyone's fervor who's in agreement with the Imperial Church
		faith:nicene = { change_fervor = -100 }
		religion:christianity_religion = {
			every_faith = {
				limit = {
					this = { considers_astray_trigger = { FAITH = faith:nicene } }
					NOT = { this = faith:nicene }
				}
				change_fervor = -50
			}
		}
		add_piety = -1000
		add_prestige = -1000
	}
}
