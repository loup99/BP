on_death = {
	on_actions = {
		bp_release_tributaries
		bp_return_gubernatorial_duchies_and_kingdoms_to_liege
	}
}

bp_release_tributaries = {
	effect = {
		root = {
			every_vassal = {
				limit = { this = { vassal_contract_has_flag = tributary_installed_flag } }
				create_title_and_vassal_change = {
					type = independency
					save_scope_as = change
					add_claim_on_loss = yes
				}
				becomes_independent = { change = scope:change }
				resolve_title_and_vassal_change = scope:change
			}
		}
	}
}

bp_return_gubernatorial_duchies_and_kingdoms_to_liege = {
	effect = {
		if = {
			limit = {
				has_government = gubernatorial_government
				primary_title.tier >= tier_duchy
			}
			create_title_and_vassal_change = {
				type = revoked
				save_scope_as = change
				add_claim_on_loss = no
			}
			every_held_title = {
				limit = {
					tier >= tier_duchy
					#Titular Titles shouldn't be sent upwards
					trigger_if = {
						limit = { this = { is_titular = yes } }
						always = no
					}
					#Non-Titular Kingdoms always go up
					trigger_else_if = {
						limit = {
							this.tier = tier_kingdom
							is_titular = no
						}
						always = yes
					}
					#Duchies shouldn't be sent upwards if it contains the capital
					trigger_else_if = {
						limit = { this.tier = tier_duchy }
						NOT = { root.capital_county = this.title_capital_county }
					}
					trigger_else = { always = no }
				}
				change_title_holder = {
					holder = root.liege
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
		}
	}
}
