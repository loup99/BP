##### Changed from Vanilla: Removed -50% Steward Effectiveness for tribals; it's a flat 50% for the government
task_develop_county = {
	position = councillor_steward

	task_type = task_type_county
	county_target = realm
	ai_county_target = domain
	task_progress = task_progress_value
	task_current_value = scope:councillor_liege.steward_develop_county_current_progress
	task_max_value = 100
	highlight_own_realm = yes

	effect_desc = {
		desc = task_develop_county_complete_effect_desc
		desc = task_develop_county_effect_desc
		desc = {
			desc = council_task_possible_side_effects
			triggered_desc = {
				trigger = {
					stewardship > mediocre_skill_rating
					trigger_if = {
						limit = {
							exists = scope:county
						}
						scope:county = {
							NOT = { has_county_modifier = steward_task_efficient_taxation_modifier }
						}
					}
				}
				desc = task_develop_county_efficient_taxation
			}
			triggered_desc = {
				trigger = {
					stewardship > mediocre_skill_rating
					trigger_if = {
						limit = { exists = scope:county }
						scope:county = {
							county_control < full_county_control
						}
					}
				}
				desc = task_develop_county_increased_control
			}
			triggered_desc = {
				trigger = {
					stewardship < high_skill_rating
					trigger_if = {
						limit = { exists = scope:county }
						scope:county = {
							NOT = { has_county_modifier = steward_settler_resistance_modifier }
						}
					}
				}
				desc = task_develop_county_increased_control
			}
			triggered_desc = {
				trigger = {
					stewardship < high_skill_rating
					trigger_if = {
						limit = { exists = scope:county }
						scope:county = {
							NOT = { has_county_modifier = steward_construction_slowdown_modifier }
						}
					}
				}
				desc = task_develop_county_slow_construction
			}
			triggered_desc = {
				trigger = {
					stewardship < high_skill_rating
					trigger_if = {
						limit = { exists = scope:county }
						scope:county = {
							NOT = { has_county_modifier = steward_population_mismanaged_modifier }
						}
					}
				}
				desc = task_develop_county_loss_of_opinion
			}
			triggered_desc = {
				trigger = {
					stewardship < high_skill_rating
					trigger_if = {
						limit = { exists = scope:county }
						scope:county = {
							county_control > low_county_control
						}
					}
				}
				desc = task_develop_county_loss_of_control
			}
		}
	}

	##### Changed from Vanilla vvvvv

	# TOTAL PROGRESS MUST MATCH THE TOTAL OF THE COUNTY MODIFIERS BELOW
		# Add all new progress values to the script value steward_develop_county_total
		# Note that for Develop County, the County Modifiers apply the actual values, while progress is for player info only
	progress = {
		value = 0
		add = {
			value = steward_develop_county_base
			desc = STEWARD_PROGRESS_BASE
		}
		add = {
			value = scope:councillor.steward_develop_county_monthly_increase
			desc = SCALED_COUNCILLOR_STEWARDSHIP_VALUE
		}
		if = {
			limit = {
				scope:councillor_liege = { has_perk = planned_cultivation_perk }
			}
			add = {
				value = scope:councillor.steward_develop_county_perk_bonus_monthly_increase
				desc = DEVELOP_COUNTY_PERK_BONUS_VALUE
			}
		}
		if = {
			limit = {
				councillor_liege_has_erudition_legacy_5_perk = yes
			}
			add = {
				value = scope:councillor.steward_develop_county_erudition_bonus_monthly_increase
				desc = ERUDITION_DYNASTY_PERK_BONUS_VALUE
			}
		}
		if = {
			limit = {
				councillor_liege_has_family_business_bonus = yes
			}
			add = {
				value = scope:councillor.steward_develop_county_family_business_monthly_increase
				desc = FAMILY_BUSINESS_BONUS_VALUE
			}
		}

		# Relation Bonuses/Penalties
		if = { # Friend
			limit = {
				scope:councillor_liege = {
					has_relation_friend = scope:councillor
					NOT = { has_relation_best_friend = scope:councillor }
				}
			}
			add = {
				value = scope:councillor.steward_develop_county_monthly_increase_friend_bonus
				desc = COUNCILLOR_IS_YOUR_FRIEND
			}
		}
		if = { # Best Friend
			limit = {
				scope:councillor_liege = {
					has_relation_best_friend = scope:councillor
				}
			}
			add = {
				value = scope:councillor.steward_develop_county_monthly_increase_best_friend_bonus
				desc = COUNCILLOR_IS_YOUR_BEST_FRIEND
			}
		}
		if = { # Rival
			limit = {
				scope:councillor_liege = {
					has_relation_rival = scope:councillor
					NOT = { has_relation_nemesis = scope:councillor }
				}
			}
			add = {
				value = scope:councillor.steward_develop_county_monthly_increase_rival_bonus
				desc = COUNCILLOR_IS_YOUR_RIVAL
			}
		}
		if = { # Nemesis
			limit = {
				scope:councillor_liege = {
					has_relation_nemesis = scope:councillor
				}
			}
			add = {
				value = scope:councillor.steward_develop_county_monthly_increase_nemesis_bonus
				desc = COUNCILLOR_IS_YOUR_NEMESIS
			}
		}
		##### Changed from Vanilla: Removed -50% Steward Effectiveness for tribals; it's a flat 50% for the government
		if = { # Development reduces the speed.
			limit = {
				exists = scope:county
				scope:county = {
					development_level > 0
				}
			}
			add = {
				value = scope:county.current_development_penalty
				desc = STEWARD_CURRENT_DEVELOPMENT_PENALTY
			}
		}
		
		if = {
			limit = { exists = scope:county }
			multiply = {
				value = scope:county.development_rate_modifier
				desc = STEWARD_COUNTY_SPEED_MODIFIERS
			}
		}
	}
	##### Changed from Vanilla ^^^^^
	full_progress = steward_develop_county_full_progress
	custom_other_loc = STEWARD_COUNTY_SPEED_OTHER

	potential_county = {
		scope:county = {
			development_level < max_development_level
			trigger_if = {
				limit = {
					scope:councillor_liege = {
						is_ai = yes
						exists = capital_county
					}
				}
				OR = {
					this = scope:councillor_liege.capital_county
					AND = {
						holder = scope:councillor_liege
						title_province = {
							OR = {
								terrain = oasis
								terrain = farmlands
								terrain = floodplains
							}
						}
					}
				}
				OR = {
					culture = scope:councillor_liege.culture
					culture = {
						cultural_acceptance = { target = scope:councillor_liege.culture value >= 50 }
					}
					scope:councillor_liege = {
						primary_title.tier < tier_duchy
					}
					AND = {
						scope:councillor_liege = {
							has_character_flag = agenda_towards_deescalation
						}
						NOT = {
							culture = scope:councillor_liege.culture
						}
					}
				}
			}
		}
	}

	county_modifier = {
		name = steward_develop_county_modifier
		development_growth = 100
		holding_build_speed = -7
		#holding_build_gold_cost = -1
		build_speed = -7
		#build_gold_cost = -1
		scale = { value = steward_develop_county_total divide = 100 }
	}

	county_modifier = {
		name = steward_develop_county_current_development_modifier
		development_growth = 100
		scale = { value = scope:councillor.current_development_penalty divide = 100 }
	}

	county_modifier = {
		name = steward_develop_county_tribal_penalty_modifier
		development_growth = 100
		scale = {
			value = 0
			if = {
				limit = {
					scope:councillor_liege = {
						should_apply_tribal_development_penalty_trigger = yes
					}
				}
				value = scope:councillor.steward_develop_county_tribal_penalty
				divide = 100
			}
		}
	}

	on_start_task_county = {
		# save current development_level for catalyst purpose
		if = {
			limit = { exists = scope:county }
			scope:county = {
				set_variable = {
					name = current_development_level
					value = development_level
				}
			}
		}
	}

	on_finish_task_county = {
		if = {
			limit = {
				OR = {
					AND = {
						exists = scope:county
						scope:county = {
							development_level = max_development_level
						}
					}
					scope:councillor_liege = {
						is_ai = yes
					}
				}
			}
			start_default_task = yes
		}
	}

	monthly_on_action = task_develop_county_side_effects

	on_monthly_county = {
		scope:councillor_liege = {
			# Check development level progress
			if = {
				limit = {
					exists = scope:county
					exists = scope:county.var:current_development_level
					scope:county = {
						floored_development_value > floored_current_development_value
					}
				}
				scope:county = {
					set_variable = {
						name = current_development_level
						value = development_level
					}
				}
				
				scope:councillor_liege = {
					if = { # Try to make relevant AI's focus on Acceptance
						limit = {
							exists = primary_title
							primary_title.tier >= tier_kingdom
							any_sub_realm_county = {
								culture = {
									cultural_acceptance = { target = scope:councillor_liege.culture value < 52 }
								}
							}
							NOT = {
								has_focus = stewardship_domain_focus
							}
						}
						add_character_flag = {
							flag = no_ai_increase_development
							years = 30
						}
					}
					else = {
						add_character_flag = {
							flag = no_ai_increase_development
							years = 10
						}
					}
				}
				
				# Struggle Catalyst
				if = {
					limit = {
						exists = scope:county
						# target someone from diff faith or culture
						scope:county = {
							NAND = {
								faith = scope:councillor_liege.faith
								culture = scope:councillor_liege.culture
							}
						}

						any_character_struggle = {
							involvement = involved
							phase_has_catalyst = catalyst_improve_development_vassal_diff_faith_culture
						}
					}
					scope:councillor_liege = {
						every_character_struggle = {
							involvement = involved
							activate_struggle_catalyst = {
								catalyst = catalyst_improve_development_vassal_diff_faith_culture
								character = scope:councillor_liege
							}
						}
					}
					# Struggle Parameter
					if = {
						limit = {
							NOT = { scope:county.culture  = scope:councillor_liege.culture }
							any_character_struggle = {
								involvement = involved
								has_struggle_phase_parameter = gain_acceptance_when_developing_other_culture_county
							}
						}
						scope:county.culture = {
							save_scope_as = current_culture
							change_cultural_acceptance = {
								target = scope:councillor_liege.culture
								value =	miniscule_cultural_acceptance_value
								desc = cultural_acceptance_gain_from_phase_effects
							}
						}
					}

				}
			}
			else_if = { # fallback for previous save: the effect would trigger a month later
				limit = {
					exists = scope:county
				}
				scope:county = {
					set_variable = {
						name = current_development_level
						value = development_level
					}
				}
			}
		}
	}

	ai_will_do = {
		value = 0
		if = {
			limit = {
				scope:councillor = {
					is_performing_council_task = task_develop_county
				}
			}
			add = 10000 # Always keep going if this is already chosen
		}
		if = {
			# Don't do this too often
			limit = {
				scope:councillor_liege = { has_character_flag = no_ai_increase_development }
			}
			multiply = 0
		}
		else_if = {
			limit = {
				scope:councillor_liege.gold >= steward_increase_development_value
			}
			add = 300
		}
		if = {
			limit = {
				scope:councillor_liege.gold < 10
			}
			multiply = 0
		}
	}
}
