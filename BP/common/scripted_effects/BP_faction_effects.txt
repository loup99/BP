bp_tax_revolt_faction_demands_enforced = {
	#Control loss
	$FACTION$ = {
		every_faction_county_member = {
			custom = peasant_faction_every_county
			change_county_control = peasant_war_victory_county_control_loss
			add_county_modifier = {
				modifier = peasant_war_lost_county_modifier
				years = 10
			}
		}
		hidden_effect = { destroy_faction = yes }
	}
	#And taxes go down
	$TOP_LEVEL_LIEGE$ = {
		if = {
			limit = { has_realm_law = bureaucratic_taxation_4 }
			add_realm_law = bureaucratic_taxation_3
		}
		else_if = {
			limit = { has_realm_law = bureaucratic_taxation_3 }
			add_realm_law = bureaucratic_taxation_2
		}
		else_if = {
			limit = { has_realm_law = bureaucratic_taxation_2 }
			add_realm_law = bureaucratic_taxation_1
		}
		else_if = {
			limit = { has_realm_law = bureaucratic_taxation_1 }
			add_realm_law = bureaucratic_taxation_0
		}
		#Cause you lost to a lot of filthy peasants
		add_prestige = -500
		add_prestige_level = -1
	}
}

#Makes sure targets get correct government
bp_update_popular_revolt_governments = {
	#If sourced from tribal, make tribal.
	if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = tribal_government } }
		change_government = tribal_government
	}
	#If sourced from clan, make clan.
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = clan_government } }
		change_government = clan_government
	}
	#If sourced from feudal, make feudal.
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = feudal_government } }
		change_government = feudal_government
	}
	#If sourced from prefeudal, make prefeudal.
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = prefeudal_government } }
		change_government = prefeudal_government
	}
	#If sourced from high tribal, make high tribal.
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = high_tribal_government } }
		change_government = high_tribal_government
	}
	#If sourced from gupta, make gupta
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = gupta_government } }
		change_government = gupta_government
	}
	#If sourced from nomad, make nomad
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = nomad_government } }
		change_government = nomad_government
	}
	#More Complicated Cases
	
	#If sourced from eranshar, make eranshar iff zoroastrian
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = eranshar_government } }
		if = {
			limit = {
				exists = $CHARACTER$.capital_barony.title_province
				$CHARACTER$.capital_barony.title_province = { has_holding_type = tribal_holding }
			}
			change_government = high_tribal_government
		}
		else_if = {
			limit = { $CHARACTER$ = { has_religion = religion:zoroastrianism_religion } }
			change_government = eranshar_government
		}
		else = { change_government = prefeudal_government } ##### TODO (Beta): Change prefeudal fallback condition
	}
	#If sourced from bureaucratic types, make subroman
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_bureaucratic_government_type_trigger = yes } }
		if = {
			limit = {
				exists = $CHARACTER$.capital_barony.title_province
				$CHARACTER$.capital_barony.title_province = { has_holding_type = tribal_holding }
			}
			change_government = high_tribal_government
		}
		else = { change_government = subroman_government }
	}
	#If sourced from subroman, make subroman
	else_if = {
		limit = { $SOURCE_GOVERNMENT$ = { has_government = subroman_government } }
		if = {
			limit = {
				exists = $CHARACTER$.capital_barony.title_province
				$CHARACTER$.capital_barony.title_province = { has_holding_type = tribal_holding }
			}
			change_government = high_tribal_government
		}
		else = {
			change_government = subroman_government
			inherit_correct_subroman_taxation_law_effect = { TITLE_BEQUEATHER = $SOURCE_GOVERNMENT$ }
		}
	}
	# Something went **HORRIBLY WRONG**
	else = { change_government = clan_government }
	
	##### TODO (Beta): Re-add feudal/clan logic for popular faction revolts
	
	# #If sourced elsewhere, and Islamic, make clan.
	# else_if = {
	# 	limit = {
	# 		$SOURCE_GOVERNMENT$ = {
	# 			NOR = {
	# 				has_government = tribal_government
	# 				has_government = clan_government
	# 				has_government = feudal_government
	# 			}
	# 		}
	# 		has_religion = religion:islam_religion
	# 	}
	# 	change_government = clan_government
	# }
	# #If sourced elsewhere, and not Islamic, make feudal.
	# else_if = {
	# 	limit = {
	# 		$SOURCE_GOVERNMENT$ = {
	# 			NOR = {
	# 				has_government = tribal_government
	# 				has_government = clan_government
	# 				has_government = feudal_government
	# 			}
	# 		}
	# 		NOT = { has_religion = religion:islam_religion }
	# 	}
	# 	change_government = feudal_government
	# }
}
